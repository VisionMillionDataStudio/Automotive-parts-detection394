# æ±½è½¦é›¶éƒ¨ä»¶æ£€æµ‹æ£€æµ‹ç³»ç»Ÿæºç åˆ†äº«
 # [ä¸€æ¡é¾™æ•™å­¦YOLOV8æ ‡æ³¨å¥½çš„æ•°æ®é›†ä¸€é”®è®­ç»ƒ_70+å…¨å¥—æ”¹è¿›åˆ›æ–°ç‚¹å‘åˆŠ_Webå‰ç«¯å±•ç¤º]

### 1.ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

é¡¹ç›®å‚è€ƒ[AAAI Association for the Advancement of Artificial Intelligence](https://gitee.com/qunshansj/projects)

é¡¹ç›®æ¥æº[AACV Association for the Advancement of Computer Vision](https://gitee.com/qunmasj/projects)

ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

éšç€å…¨çƒæ±½è½¦å·¥ä¸šçš„å¿«é€Ÿå‘å±•ï¼Œæ±½è½¦é›¶éƒ¨ä»¶çš„è´¨é‡å’Œå®‰å…¨æ€§æ„ˆå‘å—åˆ°é‡è§†ã€‚æ±½è½¦é›¶éƒ¨ä»¶çš„æ£€æµ‹ä¸ä»…å…³ç³»åˆ°æ•´è½¦çš„æ€§èƒ½ä¸å®‰å…¨ï¼Œè¿˜ç›´æ¥å½±å“åˆ°æ¶ˆè´¹è€…çš„ä½¿ç”¨ä½“éªŒå’Œä¼ä¸šçš„å¸‚åœºç«äº‰åŠ›ã€‚åœ¨è¿™ä¸€èƒŒæ™¯ä¸‹ï¼Œä¼ ç»Ÿçš„äººå·¥æ£€æµ‹æ–¹æ³•å› å…¶æ•ˆç‡ä½ã€æ˜“å‡ºé”™ç­‰ç¼ºé™·ï¼Œé€æ¸æ— æ³•æ»¡è¶³ç°ä»£æ±½è½¦åˆ¶é€ ä¸šå¯¹é«˜æ•ˆã€ç²¾å‡†æ£€æµ‹çš„éœ€æ±‚ã€‚å› æ­¤ï¼ŒåŸºäºè®¡ç®—æœºè§†è§‰çš„è‡ªåŠ¨åŒ–æ£€æµ‹ç³»ç»Ÿåº”è¿è€Œç”Ÿï¼Œæˆä¸ºæå‡æ±½è½¦é›¶éƒ¨ä»¶æ£€æµ‹æ•ˆç‡å’Œå‡†ç¡®æ€§çš„æœ‰æ•ˆè§£å†³æ–¹æ¡ˆã€‚

è¿‘å¹´æ¥ï¼Œæ·±åº¦å­¦ä¹ æŠ€æœ¯çš„è¿…çŒ›å‘å±•ä¸ºç›®æ ‡æ£€æµ‹é¢†åŸŸå¸¦æ¥äº†é©å‘½æ€§çš„å˜åŒ–ã€‚YOLOï¼ˆYou Only Look Onceï¼‰ç³»åˆ—æ¨¡å‹ä»¥å…¶å¿«é€Ÿã€å‡†ç¡®çš„ç‰¹ç‚¹ï¼Œå¹¿æ³›åº”ç”¨äºå„ç±»ç›®æ ‡æ£€æµ‹ä»»åŠ¡ä¸­ã€‚YOLOv8ä½œä¸ºè¯¥ç³»åˆ—çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè¿›ä¸€æ­¥æå‡äº†æ£€æµ‹ç²¾åº¦å’Œé€Ÿåº¦ï¼Œé€‚åº”äº†æ›´å¤æ‚çš„æ£€æµ‹åœºæ™¯ã€‚ç„¶è€Œï¼Œå°½ç®¡YOLOv8åœ¨ä¸€èˆ¬ç‰©ä½“æ£€æµ‹ä»»åŠ¡ä¸­è¡¨ç°å‡ºè‰²ï¼Œä½†åœ¨ç‰¹å®šé¢†åŸŸå¦‚æ±½è½¦é›¶éƒ¨ä»¶æ£€æµ‹ä¸­ï¼Œä»å­˜åœ¨ä¸€äº›æŒ‘æˆ˜ï¼Œä¾‹å¦‚å°ç›®æ ‡æ£€æµ‹å›°éš¾ã€èƒŒæ™¯å¤æ‚æ€§é«˜ç­‰ã€‚å› æ­¤ï¼Œæ”¹è¿›YOLOv8ä»¥é€‚åº”æ±½è½¦é›¶éƒ¨ä»¶æ£€æµ‹çš„éœ€æ±‚ï¼Œå…·æœ‰é‡è¦çš„ç†è®ºå’Œå®è·µæ„ä¹‰ã€‚

æœ¬ç ”ç©¶å°†åŸºäºæ”¹è¿›YOLOv8çš„æ±½è½¦é›¶éƒ¨ä»¶æ£€æµ‹ç³»ç»Ÿï¼Œåˆ©ç”¨åŒ…å«4000å¼ å›¾åƒå’Œ6ä¸ªç±»åˆ«ï¼ˆæ°”ç¼¸ç›–ã€æ’æ°”é˜€ã€å¼¹ç°§åº§å«åœˆã€å¸¦å¤¹çš„å¼¹ç°§ã€å¯†å°åœˆã€é˜€é—¨ç»„ä»¶ï¼‰çš„æ•°æ®é›†è¿›è¡Œè®­ç»ƒå’Œæµ‹è¯•ã€‚è¯¥æ•°æ®é›†çš„æ„å»ºä¸ä»…æ¶µç›–äº†æ±½è½¦é›¶éƒ¨ä»¶çš„å¤šæ ·æ€§ï¼Œè¿˜æä¾›äº†ä¸°å¯Œçš„æ ·æœ¬ï¼Œèƒ½å¤Ÿæœ‰æ•ˆæå‡æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚é€šè¿‡å¯¹æ•°æ®é›†çš„æ·±å…¥åˆ†æä¸å¤„ç†ï¼Œç ”ç©¶å°†æ¢ç´¢å¦‚ä½•ä¼˜åŒ–YOLOv8çš„ç½‘ç»œç»“æ„å’Œè®­ç»ƒç­–ç•¥ï¼Œä»¥æé«˜å…¶åœ¨æ±½è½¦é›¶éƒ¨ä»¶æ£€æµ‹ä¸­çš„è¡¨ç°ã€‚

æœ¬ç ”ç©¶çš„æ„ä¹‰åœ¨äºï¼Œé¦–å…ˆï¼Œèƒ½å¤Ÿä¸ºæ±½è½¦åˆ¶é€ ä¼ä¸šæä¾›ä¸€ç§é«˜æ•ˆã€å‡†ç¡®çš„é›¶éƒ¨ä»¶æ£€æµ‹è§£å†³æ–¹æ¡ˆï¼Œé™ä½äººå·¥æˆæœ¬ï¼Œæé«˜ç”Ÿäº§æ•ˆç‡ã€‚å…¶æ¬¡ï¼Œé€šè¿‡å¯¹YOLOv8çš„æ”¹è¿›ï¼Œæ¨åŠ¨ç›®æ ‡æ£€æµ‹æŠ€æœ¯åœ¨æ±½è½¦å·¥ä¸šä¸­çš„åº”ç”¨ï¼Œä¿ƒè¿›ç›¸å…³æŠ€æœ¯çš„è¿›æ­¥ä¸å‘å±•ã€‚æ­¤å¤–ï¼Œç ”ç©¶è¿˜å°†ä¸ºåç»­çš„ç›¸å…³ç ”ç©¶æä¾›åŸºç¡€æ•°æ®å’Œæ¨¡å‹æ”¯æŒï¼Œæ¨åŠ¨æ™ºèƒ½åˆ¶é€ é¢†åŸŸçš„è¿›ä¸€æ­¥å‘å±•ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼ŒåŸºäºæ”¹è¿›YOLOv8çš„æ±½è½¦é›¶éƒ¨ä»¶æ£€æµ‹ç³»ç»Ÿçš„ç ”ç©¶ï¼Œä¸ä»…å…·æœ‰é‡è¦çš„å­¦æœ¯ä»·å€¼ï¼Œä¹Ÿå…·æœ‰å¹¿æ³›çš„åº”ç”¨å‰æ™¯ã€‚é€šè¿‡æå‡æ±½è½¦é›¶éƒ¨ä»¶çš„æ£€æµ‹æ•ˆç‡å’Œå‡†ç¡®æ€§ï¼Œèƒ½å¤Ÿæœ‰æ•ˆä¿éšœæ±½è½¦çš„å®‰å…¨æ€§å’Œå¯é æ€§ï¼Œä¸ºæ¶ˆè´¹è€…æä¾›æ›´ä¼˜è´¨çš„äº§å“ä½“éªŒï¼ŒåŒæ—¶ä¹Ÿä¸ºæ±½è½¦è¡Œä¸šçš„æ™ºèƒ½åŒ–è½¬å‹è´¡çŒ®åŠ›é‡ã€‚

### 2.å›¾ç‰‡æ¼”ç¤º

![1.png](1.png)

![2.png](2.png)

![3.png](3.png)

##### æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ2.å›¾ç‰‡æ¼”ç¤ºâ€å’Œâ€œ3.è§†é¢‘æ¼”ç¤ºâ€å±•ç¤ºçš„ç³»ç»Ÿå›¾ç‰‡æˆ–è€…è§†é¢‘å¯èƒ½ä¸ºè€ç‰ˆæœ¬ï¼Œæ–°ç‰ˆæœ¬åœ¨è€ç‰ˆæœ¬çš„åŸºç¡€ä¸Šå‡çº§å¦‚ä¸‹ï¼šï¼ˆå®é™…æ•ˆæœä»¥å‡çº§çš„æ–°ç‰ˆæœ¬ä¸ºå‡†ï¼‰

  ï¼ˆ1ï¼‰é€‚é…äº†YOLOV8çš„â€œç›®æ ‡æ£€æµ‹â€æ¨¡å‹å’Œâ€œå®ä¾‹åˆ†å‰²â€æ¨¡å‹ï¼Œé€šè¿‡åŠ è½½ç›¸åº”çš„æƒé‡ï¼ˆ.ptï¼‰æ–‡ä»¶å³å¯è‡ªé€‚åº”åŠ è½½æ¨¡å‹ã€‚

  ï¼ˆ2ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«æ¨¡å¼ã€‚

  ï¼ˆ3ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«ç»“æœä¿å­˜å¯¼å‡ºï¼Œè§£å†³æ‰‹åŠ¨å¯¼å‡ºï¼ˆå®¹æ˜“å¡é¡¿å‡ºç°çˆ†å†…å­˜ï¼‰å­˜åœ¨çš„é—®é¢˜ï¼Œè¯†åˆ«å®Œè‡ªåŠ¨ä¿å­˜ç»“æœå¹¶å¯¼å‡ºåˆ°tempDirä¸­ã€‚

  ï¼ˆ4ï¼‰æ”¯æŒWebå‰ç«¯ç³»ç»Ÿä¸­çš„æ ‡é¢˜ã€èƒŒæ™¯å›¾ç­‰è‡ªå®šä¹‰ä¿®æ”¹ï¼Œåé¢æä¾›ä¿®æ”¹æ•™ç¨‹ã€‚

  å¦å¤–æœ¬é¡¹ç›®æä¾›è®­ç»ƒçš„æ•°æ®é›†å’Œè®­ç»ƒæ•™ç¨‹,æš‚ä¸æä¾›æƒé‡æ–‡ä»¶ï¼ˆbest.ptï¼‰,éœ€è¦æ‚¨æŒ‰ç…§æ•™ç¨‹è¿›è¡Œè®­ç»ƒåå®ç°å›¾ç‰‡æ¼”ç¤ºå’ŒWebå‰ç«¯ç•Œé¢æ¼”ç¤ºçš„æ•ˆæœã€‚

### 3.è§†é¢‘æ¼”ç¤º

[3.1 è§†é¢‘æ¼”ç¤º](https://www.bilibili.com/video/BV1sd4veiERG/)

### 4.æ•°æ®é›†ä¿¡æ¯å±•ç¤º

##### 4.1 æœ¬é¡¹ç›®æ•°æ®é›†è¯¦ç»†æ•°æ®ï¼ˆç±»åˆ«æ•°ï¼†ç±»åˆ«åï¼‰

nc: 6
names: ['Cylinder Head', 'Exhaust Valve', 'Spring Seat Washer', 'Spring with Collet', 'Stem Seal', 'Valve Assembly']


##### 4.2 æœ¬é¡¹ç›®æ•°æ®é›†ä¿¡æ¯ä»‹ç»

æ•°æ®é›†ä¿¡æ¯å±•ç¤º

åœ¨ç°ä»£æ±½è½¦å·¥ä¸šä¸­ï¼Œæ±½è½¦é›¶éƒ¨ä»¶çš„æ£€æµ‹ä¸è¯†åˆ«æ˜¯ç¡®ä¿äº§å“è´¨é‡å’Œç”Ÿäº§æ•ˆç‡çš„å…³é”®ç¯èŠ‚ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªåä¸ºâ€œAutomotive parts detectionâ€çš„æ•°æ®é›†ï¼Œæ—¨åœ¨ä¸ºæ”¹è¿›YOLOv8çš„æ±½è½¦é›¶éƒ¨ä»¶æ£€æµ‹ç³»ç»Ÿæä¾›ä¸°å¯Œçš„è®­ç»ƒæ•°æ®ã€‚è¯¥æ•°æ®é›†åŒ…å«å…­ä¸ªä¸»è¦ç±»åˆ«ï¼Œæ¶µç›–äº†æ±½è½¦å‘åŠ¨æœºåŠå…¶ç›¸å…³éƒ¨ä»¶çš„å…³é”®ç»„æˆéƒ¨åˆ†ã€‚è¿™äº›ç±»åˆ«åˆ†åˆ«æ˜¯ï¼šCylinder Headï¼ˆæ°”ç¼¸ç›–ï¼‰ã€Exhaust Valveï¼ˆæ’æ°”é˜€ï¼‰ã€Spring Seat Washerï¼ˆå¼¹ç°§åº§å«åœˆï¼‰ã€Spring with Colletï¼ˆå¸¦å¡ç®çš„å¼¹ç°§ï¼‰ã€Stem Sealï¼ˆé˜€æ†å¯†å°ï¼‰å’ŒValve Assemblyï¼ˆé˜€é—¨ç»„ä»¶ï¼‰ã€‚æ¯ä¸ªç±»åˆ«éƒ½åœ¨æ•°æ®é›†ä¸­å æ®äº†é‡è¦çš„ä½ç½®ï¼Œç¡®ä¿äº†æ¨¡å‹åœ¨å¤šæ ·åŒ–é›¶éƒ¨ä»¶æ£€æµ‹ä»»åŠ¡ä¸­çš„æœ‰æ•ˆæ€§å’Œå‡†ç¡®æ€§ã€‚

æ•°æ®é›†çš„æ„å»ºè¿‡ç¨‹æ³¨é‡å¤šæ ·æ€§å’Œä»£è¡¨æ€§ï¼Œæ¶µç›–äº†ä¸åŒå“ç‰Œã€å‹å·å’Œç”Ÿäº§å¹´ä»½çš„æ±½è½¦é›¶éƒ¨ä»¶ã€‚æ¯ä¸ªç±»åˆ«çš„æ ·æœ¬å‡ç»è¿‡ç²¾å¿ƒæŒ‘é€‰ï¼Œä»¥ç¡®ä¿åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹èƒ½å¤Ÿå­¦ä¹ åˆ°ä¸åŒé›¶éƒ¨ä»¶çš„å½¢çŠ¶ã€å°ºå¯¸å’Œç‰¹å¾ã€‚è¿™ç§å¤šæ ·æ€§ä¸ä»…æé«˜äº†æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ï¼Œè¿˜å¢å¼ºäº†å…¶åœ¨å®é™…åº”ç”¨ä¸­çš„é²æ£’æ€§ã€‚æ•°æ®é›†ä¸­åŒ…å«çš„å›¾åƒå‡ä¸ºé«˜åˆ†è¾¨ç‡ï¼Œç¡®ä¿äº†ç»†èŠ‚çš„æ¸…æ™°å¯è¾¨ï¼Œä½¿å¾—YOLOv8åœ¨è¿›è¡Œç›®æ ‡æ£€æµ‹æ—¶èƒ½å¤Ÿå‡†ç¡®è¯†åˆ«å‡ºå„ä¸ªé›¶éƒ¨ä»¶çš„ç‰¹å¾ã€‚

æ­¤å¤–ï¼Œä¸ºäº†æé«˜æ•°æ®é›†çš„å®ç”¨æ€§ï¼Œæˆ‘ä»¬è¿˜ä¸ºæ¯ä¸ªå›¾åƒæä¾›äº†è¯¦ç»†çš„æ ‡æ³¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬é›¶éƒ¨ä»¶çš„è¾¹ç•Œæ¡†å’Œç±»åˆ«æ ‡ç­¾ã€‚è¿™äº›æ ‡æ³¨ä¿¡æ¯é‡‡ç”¨æ ‡å‡†åŒ–æ ¼å¼ï¼Œä¾¿äºä¸YOLOv8æ¨¡å‹è¿›è¡Œæ— ç¼å¯¹æ¥ã€‚é€šè¿‡è¿™æ ·çš„æ ‡æ³¨æ–¹å¼ï¼Œæ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­èƒ½å¤Ÿæœ‰æ•ˆåœ°å­¦ä¹ åˆ°æ¯ä¸ªç±»åˆ«çš„ç‰¹å¾ï¼Œå¹¶åœ¨æµ‹è¯•é˜¶æ®µå®ç°é«˜æ•ˆçš„è¯†åˆ«ä¸å®šä½ã€‚

åœ¨æ•°æ®é›†çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜ç‰¹åˆ«å…³æ³¨äº†æ•°æ®çš„å¹³è¡¡æ€§ã€‚ä¸ºäº†é¿å…æ¨¡å‹åœ¨æŸäº›ç±»åˆ«ä¸Šè¿‡æ‹Ÿåˆï¼Œæˆ‘ä»¬ç¡®ä¿æ¯ä¸ªç±»åˆ«çš„æ ·æœ¬æ•°é‡ç›¸å¯¹å‡è¡¡ï¼Œå°½é‡å‡å°‘ç±»åˆ«é—´çš„åå·®ã€‚è¿™ç§å¹³è¡¡æ€§ä¸ä»…æé«˜äº†æ¨¡å‹çš„æ•´ä½“æ€§èƒ½ï¼Œè¿˜ç¡®ä¿äº†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå„ç±»é›¶éƒ¨ä»¶çš„æ£€æµ‹å‡†ç¡®ç‡ä¸ä¼šå—åˆ°å½±å“ã€‚

é€šè¿‡â€œAutomotive parts detectionâ€æ•°æ®é›†çš„è®­ç»ƒï¼Œæ”¹è¿›åçš„YOLOv8æ¨¡å‹å°†èƒ½å¤Ÿåœ¨å¤æ‚çš„æ±½è½¦é›¶éƒ¨ä»¶æ£€æµ‹ä»»åŠ¡ä¸­è¡¨ç°å‡ºè‰²ã€‚æ— è®ºæ˜¯åœ¨ç”Ÿäº§çº¿ä¸Šçš„å®æ—¶æ£€æµ‹ï¼Œè¿˜æ˜¯åœ¨åæœŸçš„è´¨é‡æ§åˆ¶ä¸­ï¼Œè¯¥æ¨¡å‹éƒ½å°†ä¸ºæ±½è½¦åˆ¶é€ å•†æä¾›å¼ºæœ‰åŠ›çš„æŠ€æœ¯æ”¯æŒã€‚æˆ‘ä»¬ç›¸ä¿¡ï¼Œè¿™ä¸€æ•°æ®é›†çš„å‘å¸ƒå°†ä¸ºæ±½è½¦è¡Œä¸šçš„æ™ºèƒ½åŒ–å‘å±•è´¡çŒ®ä¸€ä»½åŠ›é‡ï¼ŒåŒæ—¶ä¹Ÿä¸ºåç»­çš„ç ”ç©¶æä¾›äº†å®è´µçš„åŸºç¡€æ•°æ®ã€‚éšç€æŠ€æœ¯çš„ä¸æ–­è¿›æ­¥ï¼Œæˆ‘ä»¬æœŸå¾…çœ‹åˆ°æ›´å¤šåŸºäºè¯¥æ•°æ®é›†çš„åˆ›æ–°åº”ç”¨å’Œç ”ç©¶æˆæœï¼Œä¸ºæ±½è½¦é›¶éƒ¨ä»¶æ£€æµ‹é¢†åŸŸå¸¦æ¥æ–°çš„çªç ´ã€‚

![4.png](4.png)

![5.png](5.png)

![6.png](6.png)

![7.png](7.png)

![8.png](8.png)

### 5.å…¨å¥—é¡¹ç›®ç¯å¢ƒéƒ¨ç½²è§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰

[5.1 ç¯å¢ƒéƒ¨ç½²æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.ixigua.com/7404473917358506534?logTag=c807d0cbc21c0ef59de5)




[5.2 å®‰è£…Pythonè™šæ‹Ÿç¯å¢ƒåˆ›å»ºå’Œä¾èµ–åº“å®‰è£…è§†é¢‘æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.ixigua.com/7404474678003106304?logTag=1f1041108cd1f708b01a)

### 6.æ‰‹æŠŠæ‰‹YOLOV8è®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€å°ç™½æœ‰æ‰‹å°±èƒ½å­¦ä¼šï¼‰

[6.1 æ‰‹æŠŠæ‰‹YOLOV8è®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€å°ç™½æœ‰æ‰‹å°±èƒ½å­¦ä¼šï¼‰](https://www.ixigua.com/7404477157818401292?logTag=d31a2dfd1983c9668658)

### 7.70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹ä»£ç åŠ è½½è°ƒå‚è§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰

[7.1 70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹ä»£ç åŠ è½½è°ƒå‚è§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰](https://www.ixigua.com/7404478314661806627?logTag=29066f8288e3f4eea3a4)

### 8.70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹åŸç†è®²è§£ï¼ˆéç§‘ç­ä¹Ÿå¯ä»¥è½»æ¾å†™åˆŠå‘åˆŠï¼ŒV10ç‰ˆæœ¬æ­£åœ¨ç§‘ç ”å¾…æ›´æ–°ï¼‰

ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæ¯ä¸ªåˆ›æ–°ç‚¹çš„å…·ä½“åŸç†è®²è§£å°±ä¸ä¸€ä¸€å±•å¼€ï¼Œå…·ä½“è§ä¸‹åˆ—ç½‘å€ä¸­çš„åˆ›æ–°ç‚¹å¯¹åº”å­é¡¹ç›®çš„æŠ€æœ¯åŸç†åšå®¢ç½‘å€ã€Blogã€‘ï¼š

![9.png](9.png)

[8.1 70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹åŸç†è®²è§£é“¾æ¥](https://gitee.com/qunmasj/good)

### 9.ç³»ç»ŸåŠŸèƒ½å±•ç¤ºï¼ˆæ£€æµ‹å¯¹è±¡ä¸ºä¸¾ä¾‹ï¼Œå®é™…å†…å®¹ä»¥æœ¬é¡¹ç›®æ•°æ®é›†ä¸ºå‡†ï¼‰

å›¾9.1.ç³»ç»Ÿæ”¯æŒæ£€æµ‹ç»“æœè¡¨æ ¼æ˜¾ç¤º

  å›¾9.2.ç³»ç»Ÿæ”¯æŒç½®ä¿¡åº¦å’ŒIOUé˜ˆå€¼æ‰‹åŠ¨è°ƒèŠ‚

  å›¾9.3.ç³»ç»Ÿæ”¯æŒè‡ªå®šä¹‰åŠ è½½æƒé‡æ–‡ä»¶best.pt(éœ€è¦ä½ é€šè¿‡æ­¥éª¤5ä¸­è®­ç»ƒè·å¾—)

  å›¾9.4.ç³»ç»Ÿæ”¯æŒæ‘„åƒå¤´å®æ—¶è¯†åˆ«

  å›¾9.5.ç³»ç»Ÿæ”¯æŒå›¾ç‰‡è¯†åˆ«

  å›¾9.6.ç³»ç»Ÿæ”¯æŒè§†é¢‘è¯†åˆ«

  å›¾9.7.ç³»ç»Ÿæ”¯æŒè¯†åˆ«ç»“æœæ–‡ä»¶è‡ªåŠ¨ä¿å­˜

  å›¾9.8.ç³»ç»Ÿæ”¯æŒExcelå¯¼å‡ºæ£€æµ‹ç»“æœæ•°æ®

![10.png](10.png)

![11.png](11.png)

![12.png](12.png)

![13.png](13.png)

![14.png](14.png)

![15.png](15.png)

![16.png](16.png)

![17.png](17.png)

### 10.åŸå§‹YOLOV8ç®—æ³•åŸç†

åŸå§‹YOLOv8ç®—æ³•åŸç†

YOLOv8ç®—æ³•ä½œä¸ºYOLOç³»åˆ—çš„æœ€æ–°æˆå‘˜ï¼Œå»¶ç»­äº†YOLOv5å’ŒYOLOv7çš„ä¼˜è‰¯ä¼ ç»Ÿï¼ŒåŒæ—¶åœ¨å¤šä¸ªæ–¹é¢è¿›è¡Œäº†åˆ›æ–°å’Œæ”¹è¿›ï¼Œæ—¨åœ¨å®ç°æ›´é«˜æ•ˆçš„ç›®æ ‡æ£€æµ‹ã€‚è¯¥ç®—æ³•çš„ç»“æ„ä¸»è¦ç”±è¾“å…¥å±‚ã€ä¸»å¹²ç½‘ç»œã€ç‰¹å¾èåˆå±‚å’Œè§£è€¦å¤´ç»„æˆï¼Œå½¢æˆäº†ä¸€ä¸ªå®Œæ•´çš„ç›®æ ‡æ£€æµ‹æ¡†æ¶ã€‚YOLOv8åœ¨è®¾è®¡ä¸Šå¼•å…¥äº†Anchor-Freeçš„æ€æƒ³ï¼Œæ‘’å¼ƒäº†ä¼ ç»Ÿçš„Anchor-Basedæ–¹æ³•ï¼Œä½¿å¾—æ¨¡å‹åœ¨å¤„ç†ç›®æ ‡æ£€æµ‹æ—¶æ›´åŠ çµæ´»å’Œé«˜æ•ˆã€‚

åœ¨ä¸»å¹²ç½‘ç»œæ–¹é¢ï¼ŒYOLOv8ä¾ç„¶é‡‡ç”¨äº†YOLOv5çš„CSPDarknetæ¶æ„ï¼Œä½†å¯¹å…¶è¿›è¡Œäº†é‡è¦çš„æ”¹è¿›ã€‚å…·ä½“æ¥è¯´ï¼ŒYOLOv8å°†YOLOv5ä¸­çš„C3æ¨¡å—æ›¿æ¢ä¸ºC2fæ¨¡å—ã€‚C2fæ¨¡å—åœ¨è®¾è®¡ä¸Šå€Ÿé‰´äº†YOLOv7çš„ELANæ€æƒ³ï¼Œå¢åŠ äº†æ›´å¤šçš„æ®‹å·®è¿æ¥ï¼Œè¿™ä¸ä»…æå‡äº†ç‰¹å¾æå–çš„èƒ½åŠ›ï¼Œè¿˜æœ‰æ•ˆç¼“è§£äº†æ·±å±‚ç½‘ç»œä¸­çš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚C2fæ¨¡å—ç”±å¤šä¸ªCBSï¼ˆå·ç§¯+å½’ä¸€åŒ–+SiLUæ¿€æ´»ï¼‰æ¨¡å—å’ŒBottleneckç»“æ„ç»„æˆï¼Œé€šè¿‡åˆ†æ”¯çš„æ–¹å¼å¢å¼ºäº†ç‰¹å¾æµåŠ¨æ€§ï¼Œä½¿å¾—æ¨¡å‹åœ¨ä¿æŒè½»é‡åŒ–çš„åŒæ—¶ï¼Œä¾ç„¶èƒ½å¤Ÿæå–ä¸°å¯Œçš„ç‰¹å¾ä¿¡æ¯ã€‚

åœ¨ç‰¹å¾èåˆå±‚ï¼ŒYOLOv8é‡‡ç”¨äº†PAN-FPNç»“æ„ï¼Œä»¥å®ç°å¤šå°ºåº¦ç‰¹å¾çš„æ·±åº¦èåˆã€‚è¯¥ç»“æ„é€šè¿‡è‡ªä¸‹è€Œä¸Šçš„èåˆæ–¹å¼ï¼Œå°†é«˜å±‚ç‰¹å¾ä¸ä¸­å±‚ã€æµ…å±‚ç‰¹å¾è¿›è¡Œæœ‰æ•ˆç»“åˆï¼Œç¡®ä¿äº†ä¸åŒå±‚æ¬¡çš„ç‰¹å¾ä¿¡æ¯èƒ½å¤Ÿè¢«å……åˆ†åˆ©ç”¨ã€‚YOLOv8åœ¨è¿™ä¸€é˜¶æ®µçš„åˆ›æ–°ä¹‹å¤„åœ¨äºï¼Œå»é™¤äº†YOLOv5ä¸­ä¸Šé‡‡æ ·é˜¶æ®µçš„1x1å·ç§¯ï¼Œç›´æ¥å°†é«˜å±‚ç‰¹å¾è¿›è¡Œä¸Šé‡‡æ ·åä¸ä¸­å±‚ç‰¹å¾è¿›è¡Œæ‹¼æ¥ï¼Œè¿™æ ·çš„è®¾è®¡ä¸ä»…æé«˜äº†ç‰¹å¾èåˆçš„æ•ˆç‡ï¼Œè¿˜é™ä½äº†è®¡ç®—å¤æ‚åº¦ã€‚

åœ¨æ£€æµ‹å¤´éƒ¨åˆ†ï¼ŒYOLOv8é‡‡ç”¨äº†ä¸YOLOXå’ŒYOLOv6ç›¸ä¼¼çš„è§£è€¦å¤´ç»“æ„ï¼Œå°†åˆ†ç±»å’Œå›å½’ä»»åŠ¡åˆ†å¼€å¤„ç†ã€‚è¿™æ ·çš„è®¾è®¡ä½¿å¾—æ¨¡å‹åœ¨è¿›è¡Œç›®æ ‡åˆ†ç±»å’Œè¾¹æ¡†å›å½’æ—¶ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°èšç„¦äºå„è‡ªçš„ä»»åŠ¡ç‰¹æ€§ï¼Œä»è€Œæé«˜äº†æ£€æµ‹ç²¾åº¦ã€‚YOLOv8çš„æ£€æµ‹å¤´è¾“å‡ºäº†ä¸‰ä¸ªä¸åŒå°ºåº¦çš„ç‰¹å¾å›¾ï¼Œåˆ†åˆ«å¯¹åº”äº80x80ã€40x40å’Œ20x20çš„åˆ†è¾¨ç‡ï¼Œç¡®ä¿äº†æ¨¡å‹åœ¨ä¸åŒå°ºå¯¸ç›®æ ‡æ£€æµ‹æ—¶çš„é€‚åº”æ€§ã€‚

åœ¨æŸå¤±å‡½æ•°çš„è®¾è®¡ä¸Šï¼ŒYOLOv8å¼•å…¥äº†VFLLossä½œä¸ºåˆ†ç±»æŸå¤±ï¼Œå¹¶ç»“åˆDFLLosså’ŒCIoULossä½œä¸ºå›å½’æŸå¤±ã€‚è¿™ç§ç»„åˆä¸ä»…æé«˜äº†æ¨¡å‹åœ¨åˆ†ç±»ä»»åŠ¡ä¸­çš„å‡†ç¡®æ€§ï¼Œè¿˜å¢å¼ºäº†è¾¹æ¡†å›å½’çš„æ•ˆæœï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å°ç›®æ ‡å’Œå¤æ‚åœºæ™¯æ—¶ï¼Œèƒ½å¤Ÿæœ‰æ•ˆæå‡æ£€æµ‹æ€§èƒ½ã€‚æ­¤å¤–ï¼ŒYOLOv8è¿˜é‡‡ç”¨äº†Task-Alignedçš„æ ·æœ¬åŒ¹é…ç­–ç•¥ï¼ŒåŠ¨æ€è°ƒæ•´æ­£è´Ÿæ ·æœ¬çš„åˆ†é…ï¼Œä½¿å¾—æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­èƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”æ•°æ®åˆ†å¸ƒï¼Œè¿›ä¸€æ­¥æå‡äº†æ£€æµ‹çš„é²æ£’æ€§ã€‚

åœ¨æ•°æ®é¢„å¤„ç†æ–¹é¢ï¼ŒYOLOv8å»¶ç»­äº†YOLOv5çš„ç­–ç•¥ï¼Œé‡‡ç”¨äº†å¤šç§æ•°æ®å¢å¼ºæŠ€æœ¯ï¼Œå¦‚é©¬èµ›å…‹å¢å¼ºã€æ··åˆå¢å¼ºã€ç©ºé—´æ‰°åŠ¨å’Œé¢œè‰²æ‰°åŠ¨ç­‰ï¼Œä»¥æé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚ç„¶è€Œï¼Œåœ¨è®­ç»ƒçš„æœ€åé˜¶æ®µï¼ŒYOLOv8åœæ­¢ä½¿ç”¨é©¬èµ›å…‹å¢å¼ºï¼Œä»¥é¿å…å¯¹æ•°æ®çœŸå®åˆ†å¸ƒçš„ç ´åï¼Œä»è€Œä½¿æ¨¡å‹èƒ½å¤Ÿæ›´å¥½åœ°å­¦ä¹ åˆ°æœ‰æ•ˆçš„ç‰¹å¾ã€‚

æ€»çš„æ¥è¯´ï¼ŒYOLOv8åœ¨åŸæœ‰YOLOç³»åˆ—çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡å¼•å…¥C2fæ¨¡å—ã€PAN-FPNç»“æ„ã€è§£è€¦å¤´è®¾è®¡ä»¥åŠæ”¹è¿›çš„æŸå¤±å‡½æ•°ç­‰å¤šé¡¹åˆ›æ–°ï¼Œæ˜¾è‘—æå‡äº†ç›®æ ‡æ£€æµ‹çš„æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚å…¶åœ¨å¤„ç†å¤æ‚åœºæ™¯å’Œå°ç›®æ ‡æ—¶çš„è¡¨ç°å°¤ä¸ºçªå‡ºï¼Œå±•ç°äº†å¼ºå¤§çš„åº”ç”¨æ½œåŠ›ã€‚éšç€YOLOv8çš„æ¨å‡ºï¼Œç›®æ ‡æ£€æµ‹é¢†åŸŸçš„ç ”ç©¶å’Œåº”ç”¨å°†è¿æ¥æ–°çš„æœºé‡å’ŒæŒ‘æˆ˜ã€‚

![18.png](18.png)

### 11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰

#### 11.1 code\ultralytics\trackers\basetrack.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å’Œæ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼Œä¿ç•™äº†å¯¹è±¡è·Ÿè¸ªçš„åŸºæœ¬ç»“æ„å’ŒåŠŸèƒ½ï¼š

```python
# Ultralytics YOLO ğŸš€, AGPL-3.0 license
"""è¯¥æ¨¡å—å®šä¹‰äº†YOLOä¸­çš„å¯¹è±¡è·Ÿè¸ªçš„åŸºæœ¬ç±»å’Œç»“æ„ã€‚"""

from collections import OrderedDict
import numpy as np

class TrackState:
    """
    è¡¨ç¤ºè¢«è·Ÿè¸ªå¯¹è±¡å¯èƒ½çŠ¶æ€çš„æšä¸¾ç±»ã€‚

    å±æ€§:
        New (int): å¯¹è±¡è¢«æ–°æ£€æµ‹åˆ°çš„çŠ¶æ€ã€‚
        Tracked (int): å¯¹è±¡åœ¨åç»­å¸§ä¸­æˆåŠŸè·Ÿè¸ªçš„çŠ¶æ€ã€‚
        Lost (int): å¯¹è±¡ä¸å†è¢«è·Ÿè¸ªçš„çŠ¶æ€ã€‚
        Removed (int): å¯¹è±¡è¢«ç§»é™¤è·Ÿè¸ªçš„çŠ¶æ€ã€‚
    """
    New = 0        # æ–°æ£€æµ‹åˆ°
    Tracked = 1    # æˆåŠŸè·Ÿè¸ª
    Lost = 2       # ä¸¢å¤±
    Removed = 3    # ç§»é™¤

class BaseTrack:
    """
    å¯¹è±¡è·Ÿè¸ªçš„åŸºç±»ï¼Œæä¾›åŸºç¡€å±æ€§å’Œæ–¹æ³•ã€‚

    å±æ€§:
        _count (int): ç±»çº§åˆ«çš„å”¯ä¸€è·Ÿè¸ªIDè®¡æ•°å™¨ã€‚
        track_id (int): è·Ÿè¸ªçš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚
        is_activated (bool): æ ‡å¿—è¡¨ç¤ºè·Ÿè¸ªæ˜¯å¦å¤„äºæ¿€æ´»çŠ¶æ€ã€‚
        state (TrackState): å½“å‰è·Ÿè¸ªçŠ¶æ€ã€‚
        history (OrderedDict): è·Ÿè¸ªçŠ¶æ€çš„æœ‰åºå†å²è®°å½•ã€‚
        features (list): ä»å¯¹è±¡ä¸­æå–çš„ç”¨äºè·Ÿè¸ªçš„ç‰¹å¾åˆ—è¡¨ã€‚
        curr_feature (any): å½“å‰è¢«è·Ÿè¸ªå¯¹è±¡çš„ç‰¹å¾ã€‚
        score (float): è·Ÿè¸ªçš„ç½®ä¿¡åº¦åˆ†æ•°ã€‚
        start_frame (int): å¼€å§‹è·Ÿè¸ªçš„å¸§ç¼–å·ã€‚
        frame_id (int): æœ€è¿‘å¤„ç†çš„å¸§IDã€‚
        time_since_update (int): è‡ªä¸Šæ¬¡æ›´æ–°ä»¥æ¥ç»è¿‡çš„å¸§æ•°ã€‚
        location (tuple): åœ¨å¤šæ‘„åƒå¤´è·Ÿè¸ªä¸­çš„å¯¹è±¡ä½ç½®ã€‚
    """

    _count = 0  # ç±»çº§åˆ«çš„è·Ÿè¸ªIDè®¡æ•°å™¨

    def __init__(self):
        """åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„è·Ÿè¸ªå¯¹è±¡ï¼Œåˆ†é…å”¯ä¸€IDå’ŒåŸºç¡€è·Ÿè¸ªå±æ€§ã€‚"""
        self.track_id = BaseTrack.next_id()  # è·å–å”¯ä¸€çš„è·Ÿè¸ªID
        self.is_activated = False              # åˆå§‹çŠ¶æ€ä¸ºæœªæ¿€æ´»
        self.state = TrackState.New            # åˆå§‹çŠ¶æ€ä¸ºæ–°æ£€æµ‹
        self.history = OrderedDict()           # è·Ÿè¸ªçŠ¶æ€çš„å†å²è®°å½•
        self.features = []                      # ç‰¹å¾åˆ—è¡¨
        self.curr_feature = None                # å½“å‰ç‰¹å¾
        self.score = 0                         # åˆå§‹ç½®ä¿¡åº¦åˆ†æ•°
        self.start_frame = 0                   # å¼€å§‹å¸§ç¼–å·
        self.frame_id = 0                      # æœ€è¿‘å¸§ID
        self.time_since_update = 0             # è‡ªä¸Šæ¬¡æ›´æ–°ä»¥æ¥çš„å¸§æ•°
        self.location = (np.inf, np.inf)       # åˆå§‹ä½ç½®ä¸ºæ— ç©·å¤§

    @property
    def end_frame(self):
        """è¿”å›è·Ÿè¸ªçš„æœ€åå¸§IDã€‚"""
        return self.frame_id

    @staticmethod
    def next_id():
        """é€’å¢å¹¶è¿”å›å…¨å±€è·Ÿè¸ªIDè®¡æ•°å™¨ã€‚"""
        BaseTrack._count += 1
        return BaseTrack._count

    def activate(self, *args):
        """æ¿€æ´»è·Ÿè¸ªçš„æŠ½è±¡æ–¹æ³•ï¼Œéœ€åœ¨å­ç±»ä¸­å®ç°ã€‚"""
        raise NotImplementedError

    def predict(self):
        """é¢„æµ‹è·Ÿè¸ªçš„ä¸‹ä¸€ä¸ªçŠ¶æ€çš„æŠ½è±¡æ–¹æ³•ï¼Œéœ€åœ¨å­ç±»ä¸­å®ç°ã€‚"""
        raise NotImplementedError

    def update(self, *args, **kwargs):
        """ä½¿ç”¨æ–°è§‚å¯Ÿç»“æœæ›´æ–°è·Ÿè¸ªçš„æŠ½è±¡æ–¹æ³•ï¼Œéœ€åœ¨å­ç±»ä¸­å®ç°ã€‚"""
        raise NotImplementedError

    def mark_lost(self):
        """å°†è·Ÿè¸ªæ ‡è®°ä¸ºä¸¢å¤±ã€‚"""
        self.state = TrackState.Lost

    def mark_removed(self):
        """å°†è·Ÿè¸ªæ ‡è®°ä¸ºç§»é™¤ã€‚"""
        self.state = TrackState.Removed

    @staticmethod
    def reset_id():
        """é‡ç½®å…¨å±€è·Ÿè¸ªIDè®¡æ•°å™¨ã€‚"""
        BaseTrack._count = 0
```

### ä»£ç è¯´æ˜ï¼š
1. **TrackState ç±»**ï¼šå®šä¹‰äº†è·Ÿè¸ªå¯¹è±¡çš„å››ç§çŠ¶æ€ï¼Œä¾¿äºç®¡ç†å’Œåˆ¤æ–­å¯¹è±¡çš„è·Ÿè¸ªæƒ…å†µã€‚
2. **BaseTrack ç±»**ï¼šæ˜¯ä¸€ä¸ªåŸºç±»ï¼ŒåŒ…å«äº†è·Ÿè¸ªå¯¹è±¡çš„åŸºæœ¬å±æ€§å’Œæ–¹æ³•ï¼Œæä¾›äº†è·Ÿè¸ªIDçš„ç”Ÿæˆã€çŠ¶æ€ç®¡ç†å’Œæ›´æ–°æœºåˆ¶ã€‚
3. **åˆå§‹åŒ–æ–¹æ³•**ï¼šåœ¨åˆ›å»ºè·Ÿè¸ªå¯¹è±¡æ—¶ï¼Œåˆå§‹åŒ–å…¶çŠ¶æ€ã€ç‰¹å¾ã€IDç­‰åŸºæœ¬ä¿¡æ¯ã€‚
4. **æŠ½è±¡æ–¹æ³•**ï¼š`activate`ã€`predict` å’Œ `update` æ–¹æ³•æ˜¯æŠ½è±¡çš„ï¼Œæ„å‘³ç€å®ƒä»¬éœ€è¦åœ¨å­ç±»ä¸­å®ç°å…·ä½“çš„é€»è¾‘ã€‚
5. **çŠ¶æ€ç®¡ç†æ–¹æ³•**ï¼š`mark_lost` å’Œ `mark_removed` æ–¹æ³•ç”¨äºæ›´æ–°å¯¹è±¡çš„çŠ¶æ€ï¼Œä»¥ä¾¿åœ¨è·Ÿè¸ªè¿‡ç¨‹ä¸­è¿›è¡ŒçŠ¶æ€ç®¡ç†ã€‚

è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªç”¨äºç›®æ ‡è·Ÿè¸ªçš„åŸºç¡€ç±»å’Œç›¸å…³ç»“æ„ï¼Œä¸»è¦æ˜¯ä¸ºYOLOï¼ˆYou Only Look Onceï¼‰ç›®æ ‡æ£€æµ‹ç®—æ³•æä¾›æ”¯æŒã€‚æ–‡ä»¶ä¸­åŒ…å«äº†ä¸€ä¸ªçŠ¶æ€æšä¸¾ç±»å’Œä¸€ä¸ªåŸºç¡€è·Ÿè¸ªç±»ã€‚

é¦–å…ˆï¼Œ`TrackState`ç±»æ˜¯ä¸€ä¸ªæšä¸¾ç±»ï¼Œç”¨äºè¡¨ç¤ºè¢«è·Ÿè¸ªå¯¹è±¡çš„ä¸åŒçŠ¶æ€ã€‚å®ƒå®šä¹‰äº†å››ç§çŠ¶æ€ï¼š`New`è¡¨ç¤ºå¯¹è±¡åˆšè¢«æ£€æµ‹åˆ°ï¼Œ`Tracked`è¡¨ç¤ºå¯¹è±¡åœ¨åç»­å¸§ä¸­æˆåŠŸè¢«è·Ÿè¸ªï¼Œ`Lost`è¡¨ç¤ºå¯¹è±¡ä¸å†è¢«è·Ÿè¸ªï¼Œ`Removed`è¡¨ç¤ºå¯¹è±¡å·²ä»è·Ÿè¸ªä¸­ç§»é™¤ã€‚è¿™äº›çŠ¶æ€å¸®åŠ©ç³»ç»Ÿç®¡ç†å’Œè¯†åˆ«å¯¹è±¡åœ¨è·Ÿè¸ªè¿‡ç¨‹ä¸­çš„ä¸åŒé˜¶æ®µã€‚

æ¥ä¸‹æ¥æ˜¯`BaseTrack`ç±»ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºå¯¹è±¡è·Ÿè¸ªçš„åŸºç¡€ç±»ï¼Œæä¾›äº†ä¸€äº›åŸºæœ¬çš„å±æ€§å’Œæ–¹æ³•ã€‚è¿™ä¸ªç±»ä¸­å®šä¹‰äº†ä¸€äº›é‡è¦çš„å±æ€§ï¼Œä¾‹å¦‚`track_id`ç”¨äºå”¯ä¸€æ ‡è¯†æ¯ä¸ªè·Ÿè¸ªå¯¹è±¡ï¼Œ`is_activated`æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºè·Ÿè¸ªæ˜¯å¦å¤„äºæ¿€æ´»çŠ¶æ€ï¼Œ`state`è¡¨ç¤ºå½“å‰çš„è·Ÿè¸ªçŠ¶æ€ï¼Œ`history`æ˜¯ä¸€ä¸ªæœ‰åºå­—å…¸ï¼Œç”¨äºè®°å½•è·Ÿè¸ªçŠ¶æ€çš„å†å²ï¼Œ`features`æ˜¯ä¸€ä¸ªç‰¹å¾åˆ—è¡¨ï¼Œç”¨äºå­˜å‚¨ä»å¯¹è±¡ä¸­æå–çš„ç‰¹å¾ï¼Œ`score`æ˜¯è·Ÿè¸ªçš„ç½®ä¿¡åº¦åˆ†æ•°ï¼Œ`start_frame`å’Œ`frame_id`åˆ†åˆ«è¡¨ç¤ºè·Ÿè¸ªå¼€å§‹çš„å¸§æ•°å’Œæœ€è¿‘å¤„ç†çš„å¸§IDï¼Œ`time_since_update`è¡¨ç¤ºè‡ªä¸Šæ¬¡æ›´æ–°ä»¥æ¥ç»è¿‡çš„å¸§æ•°ï¼Œ`location`åˆ™è¡¨ç¤ºåœ¨å¤šæ‘„åƒå¤´è·Ÿè¸ªä¸­çš„å¯¹è±¡ä½ç½®ã€‚

`BaseTrack`ç±»è¿˜åŒ…å«äº†ä¸€äº›æ–¹æ³•ï¼Œå…¶ä¸­`end_frame`å±æ€§è¿”å›è·Ÿè¸ªçš„æœ€åä¸€å¸§IDï¼Œ`next_id`é™æ€æ–¹æ³•ç”¨äºé€’å¢å¹¶è¿”å›ä¸‹ä¸€ä¸ªå…¨å±€è·Ÿè¸ªIDï¼Œ`activate`ã€`predict`å’Œ`update`æ–¹æ³•æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œéœ€åœ¨å­ç±»ä¸­å®ç°ä»¥æ¿€æ´»è·Ÿè¸ªã€é¢„æµ‹ä¸‹ä¸€ä¸ªçŠ¶æ€å’Œæ›´æ–°è·Ÿè¸ªæ•°æ®ã€‚`mark_lost`å’Œ`mark_removed`æ–¹æ³•ç”¨äºå°†è·Ÿè¸ªçŠ¶æ€æ ‡è®°ä¸ºä¸¢å¤±æˆ–ç§»é™¤ã€‚æœ€åï¼Œ`reset_id`é™æ€æ–¹æ³•ç”¨äºé‡ç½®å…¨å±€è·Ÿè¸ªIDè®¡æ•°å™¨ã€‚

æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸ºYOLOç›®æ ‡æ£€æµ‹ç®—æ³•ä¸­çš„å¯¹è±¡è·Ÿè¸ªæä¾›äº†ä¸€ä¸ªåŸºç¡€æ¡†æ¶ï¼Œå®šä¹‰äº†è·Ÿè¸ªå¯¹è±¡çš„çŠ¶æ€ã€å±æ€§å’ŒåŸºæœ¬æ“ä½œï¼Œä¸ºåç»­çš„å…·ä½“å®ç°æä¾›äº†åŸºç¡€ã€‚

#### 11.2 70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\sam\modules\decoders.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import torch
from torch import nn
from typing import Tuple

class MaskDecoder(nn.Module):
    """
    MaskDecoderç±»ç”¨äºç”Ÿæˆæ©ç åŠå…¶ç›¸å…³è´¨é‡åˆ†æ•°ï¼Œé‡‡ç”¨å˜æ¢å™¨æ¶æ„æ¥é¢„æµ‹ç»™å®šå›¾åƒå’Œæç¤ºåµŒå…¥çš„æ©ç ã€‚
    """

    def __init__(self, transformer_dim: int, transformer: nn.Module, num_multimask_outputs: int = 3) -> None:
        """
        åˆå§‹åŒ–MaskDecoderç±»ã€‚

        å‚æ•°:
            transformer_dim (int): å˜æ¢å™¨æ¨¡å—çš„é€šé“ç»´åº¦
            transformer (nn.Module): ç”¨äºé¢„æµ‹æ©ç çš„å˜æ¢å™¨
            num_multimask_outputs (int): é¢„æµ‹çš„æ©ç æ•°é‡
        """
        super().__init__()
        self.transformer_dim = transformer_dim  # å˜æ¢å™¨çš„é€šé“ç»´åº¦
        self.transformer = transformer  # å˜æ¢å™¨æ¨¡å—

        self.num_multimask_outputs = num_multimask_outputs  # å¤šæ©ç è¾“å‡ºçš„æ•°é‡

        # å®šä¹‰IoUï¼ˆIntersection over Unionï¼‰ä»¤ç‰Œçš„åµŒå…¥
        self.iou_token = nn.Embedding(1, transformer_dim)
        # å®šä¹‰æ©ç ä»¤ç‰Œçš„æ•°é‡
        self.num_mask_tokens = num_multimask_outputs + 1
        # å®šä¹‰æ©ç ä»¤ç‰Œçš„åµŒå…¥
        self.mask_tokens = nn.Embedding(self.num_mask_tokens, transformer_dim)

        # å®šä¹‰è¾“å‡ºä¸Šé‡‡æ ·çš„ç¥ç»ç½‘ç»œåºåˆ—
        self.output_upscaling = nn.Sequential(
            nn.ConvTranspose2d(transformer_dim, transformer_dim // 4, kernel_size=2, stride=2),
            nn.LayerNorm(transformer_dim // 4),
            nn.GELU(),
            nn.ConvTranspose2d(transformer_dim // 4, transformer_dim // 8, kernel_size=2, stride=2),
            nn.GELU(),
        )

        # å®šä¹‰ç”¨äºç”Ÿæˆæ©ç çš„è¶…ç½‘ç»œMLP
        self.output_hypernetworks_mlps = nn.ModuleList([
            MLP(transformer_dim, transformer_dim, transformer_dim // 8, 3) for _ in range(self.num_mask_tokens)
        ])

        # å®šä¹‰ç”¨äºé¢„æµ‹æ©ç è´¨é‡çš„MLP
        self.iou_prediction_head = MLP(transformer_dim, 256, self.num_mask_tokens, 3)

    def forward(
        self,
        image_embeddings: torch.Tensor,
        image_pe: torch.Tensor,
        sparse_prompt_embeddings: torch.Tensor,
        dense_prompt_embeddings: torch.Tensor,
        multimask_output: bool,
    ) -> Tuple[torch.Tensor, torch.Tensor]:
        """
        æ ¹æ®å›¾åƒå’Œæç¤ºåµŒå…¥é¢„æµ‹æ©ç ã€‚

        å‚æ•°:
            image_embeddings (torch.Tensor): å›¾åƒç¼–ç å™¨çš„åµŒå…¥
            image_pe (torch.Tensor): ä¸å›¾åƒåµŒå…¥å½¢çŠ¶ç›¸åŒçš„ä½ç½®ç¼–ç 
            sparse_prompt_embeddings (torch.Tensor): ç‚¹å’Œæ¡†çš„åµŒå…¥
            dense_prompt_embeddings (torch.Tensor): æ©ç è¾“å…¥çš„åµŒå…¥
            multimask_output (bool): æ˜¯å¦è¿”å›å¤šä¸ªæ©ç æˆ–å•ä¸ªæ©ç ã€‚

        è¿”å›:
            torch.Tensor: æ‰¹é‡é¢„æµ‹çš„æ©ç 
            torch.Tensor: æ‰¹é‡é¢„æµ‹çš„æ©ç è´¨é‡
        """
        # é¢„æµ‹æ©ç å’ŒIoUè´¨é‡åˆ†æ•°
        masks, iou_pred = self.predict_masks(
            image_embeddings=image_embeddings,
            image_pe=image_pe,
            sparse_prompt_embeddings=sparse_prompt_embeddings,
            dense_prompt_embeddings=dense_prompt_embeddings,
        )

        # æ ¹æ®multimask_outputé€‰æ‹©æ­£ç¡®çš„æ©ç 
        mask_slice = slice(1, None) if multimask_output else slice(0, 1)
        masks = masks[:, mask_slice, :, :]
        iou_pred = iou_pred[:, mask_slice]

        return masks, iou_pred  # è¿”å›é¢„æµ‹çš„æ©ç å’Œè´¨é‡åˆ†æ•°

    def predict_masks(
        self,
        image_embeddings: torch.Tensor,
        image_pe: torch.Tensor,
        sparse_prompt_embeddings: torch.Tensor,
        dense_prompt_embeddings: torch.Tensor,
    ) -> Tuple[torch.Tensor, torch.Tensor]:
        """
        é¢„æµ‹æ©ç ã€‚

        å‚æ•°:
            image_embeddings (torch.Tensor): å›¾åƒç¼–ç å™¨çš„åµŒå…¥
            image_pe (torch.Tensor): ä¸å›¾åƒåµŒå…¥å½¢çŠ¶ç›¸åŒçš„ä½ç½®ç¼–ç 
            sparse_prompt_embeddings (torch.Tensor): ç‚¹å’Œæ¡†çš„åµŒå…¥
            dense_prompt_embeddings (torch.Tensor): æ©ç è¾“å…¥çš„åµŒå…¥

        è¿”å›:
            torch.Tensor: é¢„æµ‹çš„æ©ç 
            torch.Tensor: é¢„æµ‹çš„IoUè´¨é‡åˆ†æ•°
        """
        # è¿æ¥è¾“å‡ºä»¤ç‰Œ
        output_tokens = torch.cat([self.iou_token.weight, self.mask_tokens.weight], dim=0)
        output_tokens = output_tokens.unsqueeze(0).expand(sparse_prompt_embeddings.size(0), -1, -1)
        tokens = torch.cat((output_tokens, sparse_prompt_embeddings), dim=1)

        # æ‰©å±•æ¯ä¸ªå›¾åƒçš„æ•°æ®ä»¥é€‚åº”æ¯ä¸ªæ©ç 
        src = torch.repeat_interleave(image_embeddings, tokens.shape[0], dim=0)
        src = src + dense_prompt_embeddings
        pos_src = torch.repeat_interleave(image_pe, tokens.shape[0], dim=0)

        # è¿è¡Œå˜æ¢å™¨
        hs, src = self.transformer(src, pos_src, tokens)
        iou_token_out = hs[:, 0, :]  # IoUä»¤ç‰Œçš„è¾“å‡º
        mask_tokens_out = hs[:, 1:(1 + self.num_mask_tokens), :]  # æ©ç ä»¤ç‰Œçš„è¾“å‡º

        # ä¸Šé‡‡æ ·æ©ç åµŒå…¥å¹¶ä½¿ç”¨æ©ç ä»¤ç‰Œé¢„æµ‹æ©ç 
        src = src.transpose(1, 2).view(src.shape[0], src.shape[1], -1)
        upscaled_embedding = self.output_upscaling(src)
        hyper_in_list = [
            self.output_hypernetworks_mlps[i](mask_tokens_out[:, i, :]) for i in range(self.num_mask_tokens)
        ]
        hyper_in = torch.stack(hyper_in_list, dim=1)
        masks = (hyper_in @ upscaled_embedding.view(upscaled_embedding.shape[0], -1)).view(upscaled_embedding.shape[0], -1, upscaled_embedding.shape[2], upscaled_embedding.shape[3])

        # ç”Ÿæˆæ©ç è´¨é‡é¢„æµ‹
        iou_pred = self.iou_prediction_head(iou_token_out)

        return masks, iou_pred  # è¿”å›é¢„æµ‹çš„æ©ç å’ŒIoUè´¨é‡åˆ†æ•°

class MLP(nn.Module):
    """
    MLPï¼ˆå¤šå±‚æ„ŸçŸ¥å™¨ï¼‰æ¨¡å‹ã€‚
    """

    def __init__(self, input_dim: int, hidden_dim: int, output_dim: int, num_layers: int) -> None:
        """
        åˆå§‹åŒ–MLPæ¨¡å‹ã€‚

        å‚æ•°:
            input_dim (int): è¾“å…¥ç‰¹å¾çš„ç»´åº¦ã€‚
            hidden_dim (int): éšè—å±‚çš„ç»´åº¦ã€‚
            output_dim (int): è¾“å‡ºå±‚çš„ç»´åº¦ã€‚
            num_layers (int): éšè—å±‚çš„æ•°é‡ã€‚
        """
        super().__init__()
        self.layers = nn.ModuleList(
            nn.Linear(n, k) for n, k in zip([input_dim] + [hidden_dim] * (num_layers - 1), [hidden_dim] * (num_layers - 1) + [output_dim])
        )

    def forward(self, x):
        """æ‰§è¡Œå‰å‘ä¼ æ’­å¹¶åº”ç”¨æ¿€æ´»å‡½æ•°ã€‚"""
        for i, layer in enumerate(self.layers):
            x = F.relu(layer(x)) if i < len(self.layers) - 1 else layer(x)  # æœ€åä¸€å±‚ä¸åº”ç”¨æ¿€æ´»å‡½æ•°
        return x  # è¿”å›è¾“å‡º
```

### ä»£ç æ ¸å¿ƒéƒ¨åˆ†è¯´æ˜ï¼š
1. **MaskDecoderç±»**ï¼šè¿™æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆæ©ç çš„è§£ç å™¨æ¨¡å—ï¼Œä½¿ç”¨å˜æ¢å™¨æ¶æ„æ¥å¤„ç†å›¾åƒå’Œæç¤ºåµŒå…¥ã€‚
2. **__init__æ–¹æ³•**ï¼šåˆå§‹åŒ–ç±»çš„å‚æ•°ï¼ŒåŒ…æ‹¬å˜æ¢å™¨çš„ç»´åº¦ã€å˜æ¢å™¨æ¨¡å—ã€IoUä»¤ç‰Œå’Œæ©ç ä»¤ç‰Œçš„åµŒå…¥ç­‰ã€‚
3. **forwardæ–¹æ³•**ï¼šæ¥æ”¶å›¾åƒå’Œæç¤ºåµŒå…¥ï¼Œè°ƒç”¨`predict_masks`æ–¹æ³•è¿›è¡Œæ©ç é¢„æµ‹ï¼Œå¹¶æ ¹æ®`multimask_output`é€‰æ‹©è¿”å›çš„æ©ç ã€‚
4. **predict_masksæ–¹æ³•**ï¼šæ ¸å¿ƒçš„æ©ç é¢„æµ‹é€»è¾‘ï¼Œå¤„ç†è¾“å…¥çš„åµŒå…¥ï¼Œè¿è¡Œå˜æ¢å™¨ï¼Œç”Ÿæˆæ©ç å’ŒIoUè´¨é‡åˆ†æ•°ã€‚
5. **MLPç±»**ï¼šå®šä¹‰äº†ä¸€ä¸ªå¤šå±‚æ„ŸçŸ¥å™¨ï¼Œç”¨äºå¤„ç†ç‰¹å¾çš„å‰å‘ä¼ æ’­ã€‚

é€šè¿‡è¿™äº›æ ¸å¿ƒéƒ¨åˆ†ï¼ŒMaskDecoderèƒ½å¤Ÿæ ¹æ®è¾“å…¥çš„å›¾åƒå’Œæç¤ºç”Ÿæˆç›¸åº”çš„æ©ç å’Œè´¨é‡åˆ†æ•°ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶æ˜¯YOLOv8ç®—æ³•ä¸­çš„ä¸€ä¸ªè§£ç å™¨æ¨¡å—ï¼Œä¸»è¦ç”¨äºç”Ÿæˆå›¾åƒçš„æ©ç åŠå…¶è´¨é‡è¯„åˆ†ã€‚å®ƒé‡‡ç”¨äº†å˜æ¢å™¨ï¼ˆTransformerï¼‰æ¶æ„ï¼Œé€šè¿‡å›¾åƒå’Œæç¤ºåµŒå…¥æ¥é¢„æµ‹æ©ç ã€‚æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸¤ä¸ªä¸»è¦çš„ç±»ï¼š`MaskDecoder`å’Œ`MLP`ã€‚

`MaskDecoder`ç±»æ˜¯è§£ç å™¨çš„æ ¸å¿ƒï¼ŒåŒ…å«å¤šä¸ªå±æ€§å’Œæ–¹æ³•ã€‚æ„é€ å‡½æ•°`__init__`æ¥å—å¤šä¸ªå‚æ•°ï¼ŒåŒ…æ‹¬å˜æ¢å™¨çš„ç»´åº¦ã€å˜æ¢å™¨æ¨¡å—ã€è¾“å‡ºæ©ç çš„æ•°é‡ã€æ¿€æ´»å‡½æ•°ç±»å‹ã€IoUå¤´çš„æ·±åº¦å’Œéšè—ç»´åº¦ç­‰ã€‚è¯¥ç±»çš„ä¸»è¦å±æ€§åŒ…æ‹¬ç”¨äºç”Ÿæˆæ©ç çš„å˜æ¢å™¨ã€IoUåµŒå…¥ã€æ©ç åµŒå…¥ã€è¾“å‡ºä¸Šé‡‡æ ·çš„ç¥ç»ç½‘ç»œåºåˆ—ã€ç”¨äºç”Ÿæˆæ©ç çš„è¶…ç½‘ç»œMLPåˆ—è¡¨ä»¥åŠç”¨äºé¢„æµ‹æ©ç è´¨é‡çš„MLPã€‚

åœ¨`forward`æ–¹æ³•ä¸­ï¼Œè¾“å…¥åŒ…æ‹¬å›¾åƒåµŒå…¥ã€ä½ç½®ç¼–ç ã€ç¨€ç–å’Œå¯†é›†æç¤ºåµŒå…¥ï¼Œä»¥åŠä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºæ˜¯å¦è¿”å›å¤šä¸ªæ©ç ã€‚è¯¥æ–¹æ³•è°ƒç”¨`predict_masks`æ¥ç”Ÿæˆæ©ç å’ŒIoUé¢„æµ‹ï¼Œç„¶åæ ¹æ®`multimask_output`çš„å€¼é€‰æ‹©è¾“å‡ºçš„æ©ç å’ŒIoUé¢„æµ‹ã€‚

`predict_masks`æ–¹æ³•è´Ÿè´£å®é™…çš„æ©ç é¢„æµ‹ã€‚å®ƒé¦–å…ˆå°†IoUå’Œæ©ç åµŒå…¥è¿æ¥åœ¨ä¸€èµ·ï¼Œç„¶åå°†å›¾åƒåµŒå…¥ä¸å¯†é›†æç¤ºåµŒå…¥ç›¸åŠ ï¼Œæ¥ç€é€šè¿‡å˜æ¢å™¨è¿›è¡Œå¤„ç†ã€‚æœ€åï¼Œè¯¥æ–¹æ³•å°†æ©ç åµŒå…¥ä¸Šé‡‡æ ·ï¼Œå¹¶é€šè¿‡è¶…ç½‘ç»œMLPç”Ÿæˆæœ€ç»ˆçš„æ©ç ï¼ŒåŒæ—¶ç”ŸæˆIoUé¢„æµ‹ã€‚

`MLP`ç±»æ˜¯ä¸€ä¸ªå¤šå±‚æ„ŸçŸ¥æœºæ¨¡å‹ï¼Œé€‚ç”¨äºç”Ÿæˆæ©ç è´¨é‡çš„é¢„æµ‹ã€‚å®ƒçš„æ„é€ å‡½æ•°æ¥å—è¾“å…¥ç»´åº¦ã€éšè—å±‚ç»´åº¦ã€è¾“å‡ºç»´åº¦å’Œå±‚æ•°ç­‰å‚æ•°ã€‚`forward`æ–¹æ³•æ‰§è¡Œå‰å‘ä¼ æ’­ï¼Œå¹¶åœ¨æ¯ä¸€å±‚åº”ç”¨ReLUæ¿€æ´»å‡½æ•°ï¼Œæœ€åå¯é€‰æ‹©åœ¨è¾“å‡ºå±‚åº”ç”¨Sigmoidæ¿€æ´»ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¿™ä¸ªæ¨¡å—çš„è®¾è®¡æ—¨åœ¨åˆ©ç”¨å˜æ¢å™¨æ¶æ„é«˜æ•ˆåœ°ç”Ÿæˆå›¾åƒæ©ç ï¼Œå¹¶è¯„ä¼°å…¶è´¨é‡ï¼Œä¸ºYOLOv8çš„ç›®æ ‡æ£€æµ‹å’Œåˆ†å‰²ä»»åŠ¡æä¾›æ”¯æŒã€‚

#### 11.3 code\ultralytics\nn\modules\conv.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import math
import torch
import torch.nn as nn

def autopad(k, p=None, d=1):  # kernel, padding, dilation
    """è‡ªåŠ¨å¡«å……ä»¥ä¿æŒè¾“å‡ºå½¢çŠ¶ä¸å˜ã€‚"""
    if d > 1:
        # å¦‚æœè†¨èƒ€ç‡å¤§äº1ï¼Œè®¡ç®—å®é™…çš„å·ç§¯æ ¸å¤§å°
        k = d * (k - 1) + 1 if isinstance(k, int) else [d * (x - 1) + 1 for x in k]
    if p is None:
        # å¦‚æœæ²¡æœ‰æŒ‡å®šå¡«å……ï¼Œè‡ªåŠ¨è®¡ç®—å¡«å……å¤§å°
        p = k // 2 if isinstance(k, int) else [x // 2 for x in k]
    return p

class Conv(nn.Module):
    """æ ‡å‡†å·ç§¯å±‚ï¼ŒåŒ…å«è¾“å…¥é€šé“ã€è¾“å‡ºé€šé“ã€å·ç§¯æ ¸å¤§å°ã€æ­¥å¹…ã€å¡«å……ã€åˆ†ç»„ã€è†¨èƒ€å’Œæ¿€æ´»å‡½æ•°çš„å‚æ•°ã€‚"""

    default_act = nn.SiLU()  # é»˜è®¤æ¿€æ´»å‡½æ•°

    def __init__(self, c1, c2, k=1, s=1, p=None, g=1, d=1, act=True):
        """åˆå§‹åŒ–å·ç§¯å±‚ï¼Œè®¾ç½®å·ç§¯ã€æ‰¹å½’ä¸€åŒ–å’Œæ¿€æ´»å‡½æ•°ã€‚"""
        super().__init__()
        # åˆ›å»ºå·ç§¯å±‚
        self.conv = nn.Conv2d(c1, c2, k, s, autopad(k, p, d), groups=g, dilation=d, bias=False)
        # åˆ›å»ºæ‰¹å½’ä¸€åŒ–å±‚
        self.bn = nn.BatchNorm2d(c2)
        # è®¾ç½®æ¿€æ´»å‡½æ•°
        self.act = self.default_act if act is True else act if isinstance(act, nn.Module) else nn.Identity()

    def forward(self, x):
        """å‰å‘ä¼ æ’­ï¼šåº”ç”¨å·ç§¯ã€æ‰¹å½’ä¸€åŒ–å’Œæ¿€æ´»å‡½æ•°ã€‚"""
        return self.act(self.bn(self.conv(x)))

class DWConv(Conv):
    """æ·±åº¦å·ç§¯å±‚ï¼Œé’ˆå¯¹æ¯ä¸ªè¾“å…¥é€šé“è¿›è¡Œå·ç§¯ã€‚"""

    def __init__(self, c1, c2, k=1, s=1, d=1, act=True):
        """åˆå§‹åŒ–æ·±åº¦å·ç§¯å±‚ï¼Œè®¾ç½®è¾“å…¥é€šé“ã€è¾“å‡ºé€šé“ã€å·ç§¯æ ¸å¤§å°ã€æ­¥å¹…ã€è†¨èƒ€å’Œæ¿€æ´»å‡½æ•°ã€‚"""
        super().__init__(c1, c2, k, s, g=math.gcd(c1, c2), d=d, act=act)

class ConvTranspose(nn.Module):
    """è½¬ç½®å·ç§¯å±‚ã€‚"""

    default_act = nn.SiLU()  # é»˜è®¤æ¿€æ´»å‡½æ•°

    def __init__(self, c1, c2, k=2, s=2, p=0, bn=True, act=True):
        """åˆå§‹åŒ–è½¬ç½®å·ç§¯å±‚ï¼Œè®¾ç½®æ‰¹å½’ä¸€åŒ–å’Œæ¿€æ´»å‡½æ•°ã€‚"""
        super().__init__()
        self.conv_transpose = nn.ConvTranspose2d(c1, c2, k, s, p, bias=not bn)
        self.bn = nn.BatchNorm2d(c2) if bn else nn.Identity()
        self.act = self.default_act if act is True else act if isinstance(act, nn.Module) else nn.Identity()

    def forward(self, x):
        """å‰å‘ä¼ æ’­ï¼šåº”ç”¨è½¬ç½®å·ç§¯ã€æ‰¹å½’ä¸€åŒ–å’Œæ¿€æ´»å‡½æ•°ã€‚"""
        return self.act(self.bn(self.conv_transpose(x)))

class ChannelAttention(nn.Module):
    """é€šé“æ³¨æ„åŠ›æ¨¡å—ã€‚"""

    def __init__(self, channels: int) -> None:
        """åˆå§‹åŒ–é€šé“æ³¨æ„åŠ›æ¨¡å—ï¼Œè®¾ç½®æ± åŒ–å’Œå…¨è¿æ¥å±‚ã€‚"""
        super().__init__()
        self.pool = nn.AdaptiveAvgPool2d(1)  # è‡ªé€‚åº”å¹³å‡æ± åŒ–
        self.fc = nn.Conv2d(channels, channels, 1, 1, 0, bias=True)  # 1x1å·ç§¯
        self.act = nn.Sigmoid()  # æ¿€æ´»å‡½æ•°

    def forward(self, x: torch.Tensor) -> torch.Tensor:
        """å‰å‘ä¼ æ’­ï¼šåº”ç”¨æ± åŒ–å’Œå…¨è¿æ¥å±‚ï¼Œè®¡ç®—é€šé“æ³¨æ„åŠ›ã€‚"""
        return x * self.act(self.fc(self.pool(x)))

class SpatialAttention(nn.Module):
    """ç©ºé—´æ³¨æ„åŠ›æ¨¡å—ã€‚"""

    def __init__(self, kernel_size=7):
        """åˆå§‹åŒ–ç©ºé—´æ³¨æ„åŠ›æ¨¡å—ï¼Œè®¾ç½®å·ç§¯æ ¸å¤§å°ã€‚"""
        super().__init__()
        assert kernel_size in (3, 7), "å·ç§¯æ ¸å¤§å°å¿…é¡»ä¸º3æˆ–7"
        padding = 3 if kernel_size == 7 else 1
        self.cv1 = nn.Conv2d(2, 1, kernel_size, padding=padding, bias=False)  # å·ç§¯å±‚
        self.act = nn.Sigmoid()  # æ¿€æ´»å‡½æ•°

    def forward(self, x):
        """å‰å‘ä¼ æ’­ï¼šè®¡ç®—ç©ºé—´æ³¨æ„åŠ›ã€‚"""
        return x * self.act(self.cv1(torch.cat([torch.mean(x, 1, keepdim=True), torch.max(x, 1, keepdim=True)[0]], 1)))

class CBAM(nn.Module):
    """å·ç§¯å—æ³¨æ„åŠ›æ¨¡å—ã€‚"""

    def __init__(self, c1, kernel_size=7):
        """åˆå§‹åŒ–CBAMæ¨¡å—ï¼Œè®¾ç½®è¾“å…¥é€šé“å’Œå·ç§¯æ ¸å¤§å°ã€‚"""
        super().__init__()
        self.channel_attention = ChannelAttention(c1)  # é€šé“æ³¨æ„åŠ›
        self.spatial_attention = SpatialAttention(kernel_size)  # ç©ºé—´æ³¨æ„åŠ›

    def forward(self, x):
        """å‰å‘ä¼ æ’­ï¼šé€šè¿‡é€šé“å’Œç©ºé—´æ³¨æ„åŠ›æ¨¡å—ã€‚"""
        return self.spatial_attention(self.channel_attention(x))
```

### ä»£ç è¯´æ˜
1. **autopad**: è‡ªåŠ¨è®¡ç®—å¡«å……ï¼Œä»¥ä¿æŒå·ç§¯è¾“å‡ºçš„å½¢çŠ¶ä¸è¾“å…¥ç›¸åŒã€‚
2. **Conv**: å®šä¹‰äº†ä¸€ä¸ªæ ‡å‡†çš„å·ç§¯å±‚ï¼ŒåŒ…å«å·ç§¯ã€æ‰¹å½’ä¸€åŒ–å’Œæ¿€æ´»å‡½æ•°ã€‚
3. **DWConv**: æ·±åº¦å·ç§¯å±‚ï¼Œæ¯ä¸ªè¾“å…¥é€šé“ç‹¬ç«‹è¿›è¡Œå·ç§¯ï¼Œé€‚ç”¨äºè½»é‡çº§ç½‘ç»œã€‚
4. **ConvTranspose**: å®šä¹‰äº†è½¬ç½®å·ç§¯å±‚ï¼Œå¸¸ç”¨äºä¸Šé‡‡æ ·ã€‚
5. **ChannelAttention**: å®ç°é€šé“æ³¨æ„åŠ›æœºåˆ¶ï¼Œé€šè¿‡è‡ªé€‚åº”æ± åŒ–å’Œ1x1å·ç§¯æ¥å¢å¼ºç‰¹å¾é€šé“ã€‚
6. **SpatialAttention**: å®ç°ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶ï¼Œé€šè¿‡å·ç§¯æ¥å¢å¼ºç‰¹å¾å›¾çš„ç©ºé—´ä¿¡æ¯ã€‚
7. **CBAM**: ç»“åˆé€šé“æ³¨æ„åŠ›å’Œç©ºé—´æ³¨æ„åŠ›çš„æ¨¡å—ï¼Œå¢å¼ºç‰¹å¾è¡¨ç¤ºèƒ½åŠ›ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶æ˜¯Ultralytics YOLOï¼ˆYou Only Look Onceï¼‰æ¨¡å‹çš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦å®ç°äº†ä¸€äº›å·ç§¯æ¨¡å—ã€‚è¿™äº›æ¨¡å—æ˜¯æ„å»ºæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œå°¤å…¶æ˜¯è®¡ç®—æœºè§†è§‰ä»»åŠ¡ä¸­å¸¸ç”¨çš„åŸºç¡€ç»„ä»¶ã€‚æ–‡ä»¶ä¸­åŒ…å«äº†å¤šä¸ªç±»å’Œå‡½æ•°ï¼Œæ¯ä¸ªç±»å®ç°äº†ä¸åŒç±»å‹çš„å·ç§¯æ“ä½œæˆ–ç›¸å…³åŠŸèƒ½ã€‚

é¦–å…ˆï¼Œæ–‡ä»¶å¯¼å…¥äº†å¿…è¦çš„åº“ï¼ŒåŒ…æ‹¬`math`ã€`numpy`å’Œ`torch`ï¼Œå¹¶å®šä¹‰äº†ä¸€ä¸ªåä¸º`autopad`çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°ç”¨äºæ ¹æ®ç»™å®šçš„å·ç§¯æ ¸å¤§å°ã€å¡«å……å’Œæ‰©å¼ å‚æ•°è‡ªåŠ¨è®¡ç®—å¡«å……é‡ï¼Œä»¥ç¡®ä¿è¾“å‡ºå½¢çŠ¶ä¸è¾“å…¥å½¢çŠ¶ç›¸åŒã€‚

æ¥ä¸‹æ¥ï¼Œå®šä¹‰äº†å¤šä¸ªå·ç§¯ç›¸å…³çš„ç±»ã€‚`Conv`ç±»å®ç°äº†æ ‡å‡†çš„å·ç§¯æ“ä½œï¼ŒåŒ…å«å·ç§¯å±‚ã€æ‰¹å½’ä¸€åŒ–å±‚å’Œæ¿€æ´»å‡½æ•°ã€‚å®ƒçš„`forward`æ–¹æ³•ä¾æ¬¡åº”ç”¨å·ç§¯ã€æ‰¹å½’ä¸€åŒ–å’Œæ¿€æ´»å‡½æ•°ï¼Œè¿”å›å¤„ç†åçš„è¾“å‡ºã€‚`Conv2`ç±»æ˜¯`Conv`çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œå¢åŠ äº†ä¸€ä¸ª1x1çš„å·ç§¯æ“ä½œï¼Œä»¥ä¾¿åœ¨å‰å‘ä¼ æ’­ä¸­èåˆä¸¤ä¸ªå·ç§¯çš„è¾“å‡ºã€‚

`LightConv`ç±»å®ç°äº†ä¸€ç§è½»é‡çº§å·ç§¯ï¼Œä½¿ç”¨äº†ä¸¤ä¸ªå·ç§¯å±‚ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯æ·±åº¦å·ç§¯ï¼ˆ`DWConv`ï¼‰ï¼Œåè€…ç”¨äºå‡å°‘è®¡ç®—é‡ã€‚`DWConv`ç±»åˆ™å®ç°äº†æ·±åº¦å·ç§¯çš„å…·ä½“æ“ä½œï¼Œé€‚ç”¨äºå¤„ç†é€šé“æ•°è¾ƒå¤§çš„è¾“å…¥ã€‚

`ConvTranspose`ç±»å®ç°äº†è½¬ç½®å·ç§¯ï¼Œé€šå¸¸ç”¨äºä¸Šé‡‡æ ·æ“ä½œï¼Œç»“åˆäº†æ‰¹å½’ä¸€åŒ–å’Œæ¿€æ´»å‡½æ•°ã€‚`Focus`ç±»åˆ™é€šè¿‡å°†è¾“å…¥çš„ç©ºé—´ä¿¡æ¯å‹ç¼©åˆ°é€šé“ç»´åº¦æ¥æé«˜ç‰¹å¾æå–çš„æ•ˆç‡ã€‚

`GhostConv`ç±»å®ç°äº†ä¸€ç§åä¸ºGhostå·ç§¯çš„æ“ä½œï¼Œæ—¨åœ¨é€šè¿‡å‡å°‘å‚æ•°æ•°é‡æ¥æé«˜æ¨¡å‹çš„æ•ˆç‡ã€‚`RepConv`ç±»åˆ™æ˜¯ä¸€ä¸ªé‡å¤å·ç§¯æ¨¡å—ï¼Œæ”¯æŒè®­ç»ƒå’Œæ¨ç†çŠ¶æ€çš„è½¬æ¢ã€‚

æ­¤å¤–ï¼Œæ–‡ä»¶ä¸­è¿˜å®ç°äº†å‡ ä¸ªæ³¨æ„åŠ›æœºåˆ¶æ¨¡å—ï¼ŒåŒ…æ‹¬`ChannelAttention`å’Œ`SpatialAttention`ï¼Œå®ƒä»¬ç”¨äºåœ¨ç‰¹å¾å›¾ä¸­å¼ºè°ƒé‡è¦çš„é€šé“æˆ–ç©ºé—´ä¿¡æ¯ã€‚`CBAM`ç±»åˆ™ç»“åˆäº†è¿™ä¸¤ç§æ³¨æ„åŠ›æœºåˆ¶ï¼Œå½¢æˆäº†ä¸€ä¸ªå·ç§¯å—æ³¨æ„åŠ›æ¨¡å—ã€‚

æœ€åï¼Œ`Concat`ç±»ç”¨äºåœ¨æŒ‡å®šç»´åº¦ä¸Šè¿æ¥å¤šä¸ªå¼ é‡ï¼Œè¿™åœ¨æ„å»ºå¤æ‚çš„ç½‘ç»œç»“æ„æ—¶éå¸¸æœ‰ç”¨ã€‚

æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶æä¾›äº†ä¸€ç³»åˆ—çµæ´»ä¸”é«˜æ•ˆçš„å·ç§¯æ¨¡å—å’Œæ³¨æ„åŠ›æœºåˆ¶ï¼Œé€‚ç”¨äºæ„å»ºå’Œä¼˜åŒ–æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œå°¤å…¶æ˜¯åœ¨ç›®æ ‡æ£€æµ‹å’Œå›¾åƒåˆ†å‰²ç­‰è®¡ç®—æœºè§†è§‰ä»»åŠ¡ä¸­ã€‚

#### 11.4 train.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å’Œæ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼š

```python
import random
import numpy as np
import torch.nn as nn
from ultralytics.data import build_dataloader, build_yolo_dataset
from ultralytics.engine.trainer import BaseTrainer
from ultralytics.models import yolo
from ultralytics.nn.tasks import DetectionModel
from ultralytics.utils import LOGGER, RANK
from ultralytics.utils.torch_utils import de_parallel, torch_distributed_zero_first

class DetectionTrainer(BaseTrainer):
    """
    åŸºäºæ£€æµ‹æ¨¡å‹çš„è®­ç»ƒç±»ï¼Œç»§æ‰¿è‡ªBaseTrainerç±»ã€‚
    """

    def build_dataset(self, img_path, mode="train", batch=None):
        """
        æ„å»ºYOLOæ•°æ®é›†ã€‚

        å‚æ•°:
            img_path (str): å›¾åƒæ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚
            mode (str): æ¨¡å¼ï¼Œ`train`æˆ–`val`ï¼Œç”¨æˆ·å¯ä»¥ä¸ºæ¯ç§æ¨¡å¼è‡ªå®šä¹‰ä¸åŒçš„å¢å¼ºã€‚
            batch (int, optional): æ‰¹æ¬¡å¤§å°ï¼Œä»…ç”¨äº`rect`æ¨¡å¼ã€‚é»˜è®¤ä¸ºNoneã€‚
        """
        gs = max(int(de_parallel(self.model).stride.max() if self.model else 0), 32)  # è·å–æ¨¡å‹çš„æœ€å¤§æ­¥å¹…
        return build_yolo_dataset(self.args, img_path, batch, self.data, mode=mode, rect=mode == "val", stride=gs)

    def get_dataloader(self, dataset_path, batch_size=16, rank=0, mode="train"):
        """æ„å»ºå¹¶è¿”å›æ•°æ®åŠ è½½å™¨ã€‚"""
        assert mode in ["train", "val"]  # ç¡®ä¿æ¨¡å¼æœ‰æ•ˆ
        with torch_distributed_zero_first(rank):  # ä»…åœ¨DDPä¸­åˆå§‹åŒ–æ•°æ®é›†*.cacheä¸€æ¬¡
            dataset = self.build_dataset(dataset_path, mode, batch_size)  # æ„å»ºæ•°æ®é›†
        shuffle = mode == "train"  # è®­ç»ƒæ¨¡å¼ä¸‹æ‰“ä¹±æ•°æ®
        workers = self.args.workers if mode == "train" else self.args.workers * 2  # è®¾ç½®å·¥ä½œçº¿ç¨‹æ•°
        return build_dataloader(dataset, batch_size, workers, shuffle, rank)  # è¿”å›æ•°æ®åŠ è½½å™¨

    def preprocess_batch(self, batch):
        """å¯¹å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬ç¼©æ”¾å’Œè½¬æ¢ä¸ºæµ®ç‚¹æ•°ã€‚"""
        batch["img"] = batch["img"].to(self.device, non_blocking=True).float() / 255  # å°†å›¾åƒè½¬æ¢ä¸ºæµ®ç‚¹æ•°å¹¶å½’ä¸€åŒ–
        if self.args.multi_scale:  # å¦‚æœå¯ç”¨å¤šå°ºåº¦
            imgs = batch["img"]
            sz = (
                random.randrange(self.args.imgsz * 0.5, self.args.imgsz * 1.5 + self.stride)
                // self.stride
                * self.stride
            )  # éšæœºé€‰æ‹©ä¸€ä¸ªæ–°çš„å°ºå¯¸
            sf = sz / max(imgs.shape[2:])  # è®¡ç®—ç¼©æ”¾å› å­
            if sf != 1:  # å¦‚æœç¼©æ”¾å› å­ä¸ä¸º1
                ns = [
                    math.ceil(x * sf / self.stride) * self.stride for x in imgs.shape[2:]
                ]  # è®¡ç®—æ–°çš„å½¢çŠ¶
                imgs = nn.functional.interpolate(imgs, size=ns, mode="bilinear", align_corners=False)  # è¿›è¡Œæ’å€¼ç¼©æ”¾
            batch["img"] = imgs  # æ›´æ–°æ‰¹æ¬¡å›¾åƒ
        return batch

    def get_model(self, cfg=None, weights=None, verbose=True):
        """è¿”å›YOLOæ£€æµ‹æ¨¡å‹ã€‚"""
        model = DetectionModel(cfg, nc=self.data["nc"], verbose=verbose and RANK == -1)  # åˆ›å»ºæ£€æµ‹æ¨¡å‹
        if weights:
            model.load(weights)  # åŠ è½½æƒé‡
        return model

    def plot_training_samples(self, batch, ni):
        """ç»˜åˆ¶å¸¦æœ‰æ³¨é‡Šçš„è®­ç»ƒæ ·æœ¬ã€‚"""
        plot_images(
            images=batch["img"],
            batch_idx=batch["batch_idx"],
            cls=batch["cls"].squeeze(-1),
            bboxes=batch["bboxes"],
            paths=batch["im_file"],
            fname=self.save_dir / f"train_batch{ni}.jpg",
            on_plot=self.on_plot,
        )
```

### ä»£ç æ³¨é‡Šè¯´æ˜ï¼š
1. **ç±»å’Œæ–¹æ³•å®šä¹‰**ï¼šå®šä¹‰äº†ä¸€ä¸ª`DetectionTrainer`ç±»ï¼Œç»§æ‰¿è‡ª`BaseTrainer`ï¼Œç”¨äºè®­ç»ƒYOLOæ£€æµ‹æ¨¡å‹ã€‚
2. **æ•°æ®é›†æ„å»º**ï¼š`build_dataset`æ–¹æ³•ç”¨äºæ ¹æ®ç»™å®šçš„å›¾åƒè·¯å¾„å’Œæ¨¡å¼æ„å»ºYOLOæ•°æ®é›†ï¼Œæ”¯æŒè®­ç»ƒå’ŒéªŒè¯æ¨¡å¼ã€‚
3. **æ•°æ®åŠ è½½å™¨**ï¼š`get_dataloader`æ–¹æ³•åˆ›å»ºæ•°æ®åŠ è½½å™¨ï¼Œæ”¯æŒå¤šè¿›ç¨‹åŠ è½½å’Œæ•°æ®æ‰“ä¹±ã€‚
4. **æ‰¹æ¬¡é¢„å¤„ç†**ï¼š`preprocess_batch`æ–¹æ³•å¯¹è¾“å…¥çš„å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬å½’ä¸€åŒ–å’Œå¯é€‰çš„å¤šå°ºåº¦è°ƒæ•´ã€‚
5. **æ¨¡å‹è·å–**ï¼š`get_model`æ–¹æ³•è¿”å›ä¸€ä¸ªYOLOæ£€æµ‹æ¨¡å‹ï¼Œå¹¶å¯é€‰æ‹©æ€§åœ°åŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚
6. **ç»˜åˆ¶è®­ç»ƒæ ·æœ¬**ï¼š`plot_training_samples`æ–¹æ³•ç”¨äºå¯è§†åŒ–è®­ç»ƒæ ·æœ¬åŠå…¶å¯¹åº”çš„æ ‡ç­¾ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶ `train.py` æ˜¯ä¸€ä¸ªç”¨äºè®­ç»ƒ YOLOï¼ˆYou Only Look Onceï¼‰ç›®æ ‡æ£€æµ‹æ¨¡å‹çš„å®ç°ï¼Œç»§æ‰¿è‡ª `BaseTrainer` ç±»ã€‚ç¨‹åºä¸­åŒ…å«äº†å¤šä¸ªæ–¹æ³•ï¼Œç”¨äºæ„å»ºæ•°æ®é›†ã€è·å–æ•°æ®åŠ è½½å™¨ã€é¢„å¤„ç†å›¾åƒã€è®¾ç½®æ¨¡å‹å±æ€§ã€è·å–æ¨¡å‹ã€è¿›è¡ŒéªŒè¯ã€è®°å½•æŸå¤±ã€æ˜¾ç¤ºè®­ç»ƒè¿›åº¦ã€ç»˜åˆ¶è®­ç»ƒæ ·æœ¬å’Œç»˜åˆ¶è®­ç»ƒæŒ‡æ ‡ç­‰ã€‚

é¦–å…ˆï¼Œ`DetectionTrainer` ç±»çš„ `build_dataset` æ–¹æ³•ç”¨äºæ„å»º YOLO æ•°æ®é›†ã€‚å®ƒæ¥æ”¶å›¾åƒè·¯å¾„ã€æ¨¡å¼ï¼ˆè®­ç»ƒæˆ–éªŒè¯ï¼‰å’Œæ‰¹æ¬¡å¤§å°ä½œä¸ºå‚æ•°ï¼Œä½¿ç”¨ `build_yolo_dataset` å‡½æ•°æ¥åˆ›å»ºæ•°æ®é›†ï¼Œå¹¶æ ¹æ®æ¨¡å‹çš„æ­¥å¹…è°ƒæ•´å›¾åƒçš„å¤§å°ã€‚

æ¥ä¸‹æ¥ï¼Œ`get_dataloader` æ–¹æ³•æ„å»ºå¹¶è¿”å›æ•°æ®åŠ è½½å™¨ã€‚å®ƒä¼šæ ¹æ®æ¨¡å¼ï¼ˆè®­ç»ƒæˆ–éªŒè¯ï¼‰æ¥å†³å®šæ˜¯å¦æ‰“ä¹±æ•°æ®ï¼Œå¹¶è®¾ç½®å·¥ä½œçº¿ç¨‹çš„æ•°é‡ã€‚è¯¥æ–¹æ³•è¿˜ç¡®ä¿åœ¨åˆ†å¸ƒå¼è®­ç»ƒä¸­ï¼Œæ•°æ®é›†åªåˆå§‹åŒ–ä¸€æ¬¡ã€‚

`preprocess_batch` æ–¹æ³•ç”¨äºå¯¹å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬å°†å›¾åƒç¼©æ”¾åˆ°åˆé€‚çš„å¤§å°å¹¶è½¬æ¢ä¸ºæµ®ç‚¹æ•°æ ¼å¼ã€‚å®ƒè¿˜æ”¯æŒå¤šå°ºåº¦è®­ç»ƒï¼Œé€šè¿‡éšæœºé€‰æ‹©å›¾åƒå¤§å°æ¥å¢å¼ºæ¨¡å‹çš„é²æ£’æ€§ã€‚

`set_model_attributes` æ–¹æ³•ç”¨äºè®¾ç½®æ¨¡å‹çš„å±æ€§ï¼ŒåŒ…æ‹¬ç±»åˆ«æ•°é‡å’Œç±»åˆ«åç§°ç­‰ï¼Œä»¥ç¡®ä¿æ¨¡å‹èƒ½å¤Ÿæ­£ç¡®å¤„ç†è¾“å…¥æ•°æ®ã€‚

`get_model` æ–¹æ³•è¿”å›ä¸€ä¸ª YOLO æ£€æµ‹æ¨¡å‹ï¼Œå¹¶å¯é€‰æ‹©åŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚`get_validator` æ–¹æ³•è¿”å›ä¸€ä¸ªç”¨äºæ¨¡å‹éªŒè¯çš„ `DetectionValidator` å®ä¾‹ã€‚

åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œ`label_loss_items` æ–¹æ³•ç”¨äºè¿”å›å¸¦æœ‰æ ‡ç­¾çš„æŸå¤±å­—å…¸ï¼Œä¾¿äºè®°å½•å’Œç›‘æ§è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŸå¤±æƒ…å†µã€‚`progress_string` æ–¹æ³•ç”Ÿæˆä¸€ä¸ªæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ï¼Œç”¨äºæ˜¾ç¤ºè®­ç»ƒè¿›åº¦ï¼ŒåŒ…æ‹¬å½“å‰çš„ epochã€GPU å†…å­˜ä½¿ç”¨æƒ…å†µã€æŸå¤±å€¼ã€å®ä¾‹æ•°é‡å’Œå›¾åƒå¤§å°ç­‰ä¿¡æ¯ã€‚

æ­¤å¤–ï¼Œ`plot_training_samples` æ–¹æ³•ç”¨äºç»˜åˆ¶è®­ç»ƒæ ·æœ¬åŠå…¶æ ‡æ³¨ï¼Œå¸®åŠ©å¯è§†åŒ–è®­ç»ƒæ•°æ®çš„è´¨é‡ã€‚æœ€åï¼Œ`plot_metrics` å’Œ `plot_training_labels` æ–¹æ³•åˆ†åˆ«ç”¨äºç»˜åˆ¶è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŒ‡æ ‡å’Œæ ‡ç­¾ï¼Œä¾¿äºåˆ†ææ¨¡å‹çš„è®­ç»ƒæ•ˆæœã€‚

æ•´ä½“è€Œè¨€ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº† YOLO æ¨¡å‹è®­ç»ƒçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæä¾›äº†æ•°æ®å¤„ç†ã€æ¨¡å‹æ„å»ºã€è®­ç»ƒç›‘æ§å’Œç»“æœå¯è§†åŒ–ç­‰å¤šæ–¹é¢çš„æ”¯æŒã€‚

#### 11.5 70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\utils\downloads.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import requests
from pathlib import Path
from zipfile import ZipFile, is_zipfile
from tqdm import tqdm  # è¿›åº¦æ¡åº“

def safe_download(url, file=None, dir=None, unzip=True, delete=False, retry=3, progress=True):
    """
    ä»æŒ‡å®šçš„ URL ä¸‹è½½æ–‡ä»¶ï¼Œå¹¶å¯é€‰æ‹©è§£å‹å’Œåˆ é™¤ä¸‹è½½çš„æ–‡ä»¶ã€‚

    å‚æ•°:
        url (str): è¦ä¸‹è½½çš„æ–‡ä»¶çš„ URLã€‚
        file (str, optional): ä¸‹è½½æ–‡ä»¶çš„æ–‡ä»¶åã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä½¿ç”¨ URL çš„æ–‡ä»¶åã€‚
        dir (str, optional): ä¿å­˜ä¸‹è½½æ–‡ä»¶çš„ç›®å½•ã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä½¿ç”¨å½“å‰å·¥ä½œç›®å½•ã€‚
        unzip (bool, optional): æ˜¯å¦è§£å‹ä¸‹è½½çš„æ–‡ä»¶ã€‚é»˜è®¤å€¼ä¸º Trueã€‚
        delete (bool, optional): æ˜¯å¦åœ¨è§£å‹ååˆ é™¤ä¸‹è½½çš„æ–‡ä»¶ã€‚é»˜è®¤å€¼ä¸º Falseã€‚
        retry (int, optional): ä¸‹è½½å¤±è´¥æ—¶é‡è¯•çš„æ¬¡æ•°ã€‚é»˜è®¤å€¼ä¸º 3ã€‚
        progress (bool, optional): æ˜¯å¦åœ¨ä¸‹è½½è¿‡ç¨‹ä¸­æ˜¾ç¤ºè¿›åº¦æ¡ã€‚é»˜è®¤å€¼ä¸º Trueã€‚
    """
    # ç¡®å®šä¸‹è½½æ–‡ä»¶çš„ä¿å­˜è·¯å¾„
    f = Path(dir) / (file if file else url.split('/')[-1])  # ä½¿ç”¨ URL çš„æœ€åä¸€éƒ¨åˆ†ä½œä¸ºæ–‡ä»¶å

    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨
    if not f.is_file():
        desc = f"æ­£åœ¨ä¸‹è½½ {url} åˆ° '{f}'"
        print(desc)  # æ‰“å°ä¸‹è½½ä¿¡æ¯
        f.parent.mkdir(parents=True, exist_ok=True)  # åˆ›å»ºç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰

        for i in range(retry + 1):  # å°è¯•ä¸‹è½½ï¼Œæœ€å¤šé‡è¯• retry æ¬¡
            try:
                # ä½¿ç”¨ requests ä¸‹è½½æ–‡ä»¶
                response = requests.get(url, stream=True)
                response.raise_for_status()  # æ£€æŸ¥è¯·æ±‚æ˜¯å¦æˆåŠŸ

                # è·å–æ–‡ä»¶æ€»å¤§å°ä»¥ä¾¿æ˜¾ç¤ºè¿›åº¦æ¡
                total_size = int(response.headers.get('Content-Length', 0))
                with open(f, 'wb') as file_handle:
                    for data in tqdm(response.iter_content(chunk_size=1024), total=total_size // 1024, unit='KB', disable=not progress):
                        file_handle.write(data)  # å†™å…¥æ–‡ä»¶

                break  # ä¸‹è½½æˆåŠŸï¼Œé€€å‡ºå¾ªç¯
            except Exception as e:
                if i == retry:
                    print(f"ä¸‹è½½å¤±è´¥: {e}")  # æ‰“å°é”™è¯¯ä¿¡æ¯
                else:
                    print(f"ä¸‹è½½å¤±è´¥ï¼Œæ­£åœ¨é‡è¯• {i + 1}/{retry}...")

    # è§£å‹æ–‡ä»¶ï¼ˆå¦‚æœéœ€è¦ï¼‰
    if unzip and f.exists() and f.suffix in ('.zip', '.tar', '.gz'):
        unzip_dir = dir or f.parent  # è§£å‹åˆ°æŒ‡å®šç›®å½•æˆ–å½“å‰ç›®å½•
        if is_zipfile(f):
            with ZipFile(f, 'r') as zip_ref:
                zip_ref.extractall(unzip_dir)  # è§£å‹æ–‡ä»¶
        if delete:
            f.unlink()  # åˆ é™¤ä¸‹è½½çš„æ–‡ä»¶

    return f  # è¿”å›ä¸‹è½½çš„æ–‡ä»¶è·¯å¾„
```

### ä»£ç è¯´æ˜ï¼š
1. **å¯¼å…¥åº“**ï¼šå¯¼å…¥äº† `requests` ç”¨äºç½‘ç»œè¯·æ±‚ï¼Œ`Path` ç”¨äºæ–‡ä»¶è·¯å¾„æ“ä½œï¼Œ`ZipFile` ç”¨äºå¤„ç† ZIP æ–‡ä»¶ï¼Œ`tqdm` ç”¨äºæ˜¾ç¤ºä¸‹è½½è¿›åº¦æ¡ã€‚
  
2. **`safe_download` å‡½æ•°**ï¼šè¿™æ˜¯æ ¸å¿ƒå‡½æ•°ï¼Œè´Ÿè´£ä»æŒ‡å®š URL ä¸‹è½½æ–‡ä»¶ï¼Œå¹¶æ ¹æ®å‚æ•°å†³å®šæ˜¯å¦è§£å‹å’Œåˆ é™¤æ–‡ä»¶ã€‚
   - **å‚æ•°**ï¼š
     - `url`ï¼šè¦ä¸‹è½½çš„æ–‡ä»¶çš„ URLã€‚
     - `file`ï¼šä¸‹è½½åä¿å­˜çš„æ–‡ä»¶åã€‚
     - `dir`ï¼šæ–‡ä»¶ä¿å­˜çš„ç›®å½•ã€‚
     - `unzip`ï¼šæ˜¯å¦è§£å‹ä¸‹è½½çš„æ–‡ä»¶ã€‚
     - `delete`ï¼šæ˜¯å¦åœ¨è§£å‹ååˆ é™¤ä¸‹è½½çš„æ–‡ä»¶ã€‚
     - `retry`ï¼šä¸‹è½½å¤±è´¥æ—¶çš„é‡è¯•æ¬¡æ•°ã€‚
     - `progress`ï¼šæ˜¯å¦æ˜¾ç¤ºä¸‹è½½è¿›åº¦æ¡ã€‚
  
3. **æ–‡ä»¶è·¯å¾„å¤„ç†**ï¼šæ ¹æ®æä¾›çš„ç›®å½•å’Œæ–‡ä»¶åæ„å»ºä¸‹è½½æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼Œå¹¶ç¡®ä¿ç›®å½•å­˜åœ¨ã€‚

4. **ä¸‹è½½é€»è¾‘**ï¼šä½¿ç”¨ `requests.get` æ–¹æ³•ä¸‹è½½æ–‡ä»¶ï¼Œå¹¶é€šè¿‡ `tqdm` æ˜¾ç¤ºä¸‹è½½è¿›åº¦ã€‚å¤„ç†ä¸‹è½½å¤±è´¥çš„æƒ…å†µï¼Œå…è®¸é‡è¯•ã€‚

5. **è§£å‹æ–‡ä»¶**ï¼šå¦‚æœä¸‹è½½çš„æ–‡ä»¶æ˜¯å‹ç¼©æ–‡ä»¶ï¼Œå¹¶ä¸”è®¾ç½®äº† `unzip` ä¸º `True`ï¼Œåˆ™ä½¿ç”¨ `ZipFile` è§£å‹æ–‡ä»¶ã€‚

6. **è¿”å›å€¼**ï¼šè¿”å›ä¸‹è½½çš„æ–‡ä»¶è·¯å¾„ï¼Œæ–¹ä¾¿åç»­æ“ä½œã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶ä¸»è¦ç”¨äºå¤„ç†ä¸Ultralytics YOLOæ¨¡å‹ç›¸å…³çš„æ–‡ä»¶ä¸‹è½½å’Œç®¡ç†ã€‚ä»£ç ä¸­åŒ…å«äº†å¤šä¸ªå‡½æ•°ï¼Œæ—¨åœ¨ç®€åŒ–æ–‡ä»¶çš„ä¸‹è½½ã€è§£å‹ã€åˆ é™¤ä»¥åŠæ£€æŸ¥ç­‰æ“ä½œï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹YOLOæ¨¡å‹çš„æƒé‡æ–‡ä»¶å’Œå…¶ä»–ç›¸å…³èµ„æºã€‚

é¦–å…ˆï¼Œæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€äº›å¸¸é‡ï¼Œåˆ—å‡ºäº†åœ¨GitHubä¸Šç»´æŠ¤çš„YOLOæ¨¡å‹æƒé‡æ–‡ä»¶çš„åç§°å’Œè·¯å¾„ã€‚è¿™äº›æ–‡ä»¶åŒ…æ‹¬ä¸åŒç‰ˆæœ¬çš„YOLOv8ã€YOLOv5ã€YOLOv3ç­‰æ¨¡å‹çš„æƒé‡æ–‡ä»¶ã€‚

æ¥ä¸‹æ¥ï¼Œå®šä¹‰äº†ä¸€äº›è¾…åŠ©å‡½æ•°ã€‚`is_url`å‡½æ•°ç”¨äºæ£€æŸ¥ç»™å®šå­—ç¬¦ä¸²æ˜¯å¦ä¸ºæœ‰æ•ˆçš„URLï¼Œå¹¶ä¸”å¯ä»¥é€‰æ‹©æ€§åœ°æ£€æŸ¥è¯¥URLæ˜¯å¦å­˜åœ¨ã€‚`delete_dsstore`å‡½æ•°åˆ™ç”¨äºåˆ é™¤ç‰¹å®šç›®å½•ä¸‹çš„`.DS_Store`æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶æ˜¯macOSç³»ç»Ÿç”Ÿæˆçš„éšè—æ–‡ä»¶ï¼Œå¯èƒ½åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¹‹é—´ä¼ è¾“æ—¶é€ æˆé—®é¢˜ã€‚

`zip_directory`å’Œ`unzip_file`å‡½æ•°åˆ†åˆ«ç”¨äºå‹ç¼©å’Œè§£å‹æŒ‡å®šç›®å½•çš„å†…å®¹ï¼Œæ”¯æŒæ’é™¤ç‰¹å®šæ–‡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥æ˜¾ç¤ºè¿›åº¦æ¡ã€‚`check_disk_space`å‡½æ•°ç”¨äºæ£€æŸ¥ä¸‹è½½æ–‡ä»¶æ‰€éœ€çš„ç£ç›˜ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œç¡®ä¿åœ¨ä¸‹è½½å‰æœ‰è¶³å¤Ÿçš„ç©ºé—´ã€‚

`get_google_drive_file_info`å‡½æ•°ç”¨äºå¤„ç†Google Driveçš„åˆ†äº«é“¾æ¥ï¼Œæå–å‡ºç›´æ¥ä¸‹è½½é“¾æ¥å’Œæ–‡ä»¶åã€‚`safe_download`å‡½æ•°æ˜¯æ ¸å¿ƒä¸‹è½½å‡½æ•°ï¼Œæ”¯æŒä»URLä¸‹è½½æ–‡ä»¶ï¼Œå¤„ç†Google Driveé“¾æ¥ï¼Œæ”¯æŒé‡è¯•æœºåˆ¶ï¼Œå¹¶å¯ä»¥é€‰æ‹©è§£å‹ä¸‹è½½çš„æ–‡ä»¶ã€‚

`get_github_assets`å‡½æ•°ç”¨äºä»GitHubè·å–æŒ‡å®šä»“åº“çš„å‘å¸ƒç‰ˆæœ¬å’Œèµ„äº§åˆ—è¡¨ã€‚`attempt_download_asset`å‡½æ•°å°è¯•ä»GitHubä¸‹è½½æŒ‡å®šçš„æ–‡ä»¶ï¼Œå¦‚æœæœ¬åœ°ä¸å­˜åœ¨åˆ™è¿›è¡Œä¸‹è½½ã€‚

æœ€åï¼Œ`download`å‡½æ•°ç”¨äºå¤„ç†å¹¶å‘ä¸‹è½½ï¼Œå¦‚æœæŒ‡å®šçš„çº¿ç¨‹æ•°å¤§äº1ï¼Œåˆ™ä½¿ç”¨çº¿ç¨‹æ± è¿›è¡Œå¹¶å‘ä¸‹è½½ï¼Œå¦åˆ™é¡ºåºä¸‹è½½ã€‚è¿™ä¸ªå‡½æ•°è°ƒç”¨äº†ä¹‹å‰å®šä¹‰çš„`safe_download`å‡½æ•°ï¼Œç¡®ä¿ä¸‹è½½çš„æ–‡ä»¶èƒ½å¤Ÿè¢«æ­£ç¡®å¤„ç†ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶æä¾›äº†ä¸€ç³»åˆ—å®ç”¨çš„å·¥å…·å‡½æ•°ï¼Œæ–¹ä¾¿ç”¨æˆ·ä¸‹è½½å’Œç®¡ç†YOLOæ¨¡å‹çš„ç›¸å…³æ–‡ä»¶ï¼Œç¡®ä¿åœ¨ä½¿ç”¨è¿™äº›æ¨¡å‹æ—¶èƒ½å¤Ÿé¡ºåˆ©è·å–æ‰€éœ€çš„èµ„æºã€‚

#### 11.6 70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\nn\extra_modules\ops_dcnv3\setup.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import os
import glob
import torch
from torch.utils.cpp_extension import CUDA_HOME, CppExtension, CUDAExtension
from setuptools import find_packages, setup

# å®šä¹‰æ‰€éœ€çš„ä¾èµ–åŒ…
requirements = ["torch", "torchvision"]

def get_extensions():
    # è·å–å½“å‰æ–‡ä»¶çš„ç›®å½•
    this_dir = os.path.dirname(os.path.abspath(__file__))
    # å®šä¹‰æ‰©å±•æ¨¡å—çš„æºä»£ç ç›®å½•
    extensions_dir = os.path.join(this_dir, "src")

    # æŸ¥æ‰¾ä¸»æ–‡ä»¶å’ŒCPU/CUDAæºæ–‡ä»¶
    main_file = glob.glob(os.path.join(extensions_dir, "*.cpp"))
    source_cpu = glob.glob(os.path.join(extensions_dir, "cpu", "*.cpp"))
    source_cuda = glob.glob(os.path.join(extensions_dir, "cuda", "*.cu"))

    # åˆå¹¶æºæ–‡ä»¶
    sources = main_file + source_cpu
    extension = CppExtension  # é»˜è®¤ä½¿ç”¨ CppExtension
    extra_compile_args = {"cxx": []}  # é¢å¤–çš„ç¼–è¯‘å‚æ•°
    define_macros = []  # å®šä¹‰çš„å®

    # æ£€æŸ¥æ˜¯å¦å¯ä»¥ä½¿ç”¨CUDA
    if torch.cuda.is_available() and CUDA_HOME is not None:
        extension = CUDAExtension  # ä½¿ç”¨ CUDAExtension
        sources += source_cuda  # æ·»åŠ CUDAæºæ–‡ä»¶
        define_macros += [("WITH_CUDA", None)]  # å®šä¹‰å®ä»¥å¯ç”¨CUDAæ”¯æŒ
        extra_compile_args["nvcc"] = []  # CUDAç¼–è¯‘å™¨çš„é¢å¤–å‚æ•°
    else:
        raise NotImplementedError('Cuda is not available')  # å¦‚æœæ²¡æœ‰CUDAæ”¯æŒï¼ŒæŠ›å‡ºå¼‚å¸¸

    # å°†æºæ–‡ä»¶è·¯å¾„è½¬æ¢ä¸ºç»å¯¹è·¯å¾„
    sources = [os.path.join(extensions_dir, s) for s in sources]
    include_dirs = [extensions_dir]  # åŒ…å«ç›®å½•
    ext_modules = [
        extension(
            "DCNv3",  # æ‰©å±•æ¨¡å—çš„åç§°
            sources,  # æºæ–‡ä»¶åˆ—è¡¨
            include_dirs=include_dirs,  # åŒ…å«ç›®å½•
            define_macros=define_macros,  # å®šä¹‰çš„å®
            extra_compile_args=extra_compile_args,  # é¢å¤–çš„ç¼–è¯‘å‚æ•°
        )
    ]
    return ext_modules  # è¿”å›æ‰©å±•æ¨¡å—åˆ—è¡¨

# ä½¿ç”¨setuptoolsè¿›è¡ŒåŒ…çš„è®¾ç½®
setup(
    name="DCNv3",  # åŒ…åç§°
    version="1.1",  # ç‰ˆæœ¬å·
    author="InternImage",  # ä½œè€…
    url="https://github.com/OpenGVLab/InternImage",  # é¡¹ç›®ç½‘å€
    description="PyTorch Wrapper for CUDA Functions of DCNv3",  # æè¿°
    packages=find_packages(exclude=("configs", "tests")),  # æŸ¥æ‰¾åŒ…ï¼Œæ’é™¤æŒ‡å®šç›®å½•
    ext_modules=get_extensions(),  # è·å–æ‰©å±•æ¨¡å—
    cmdclass={"build_ext": torch.utils.cpp_extension.BuildExtension},  # æŒ‡å®šæ„å»ºæ‰©å±•çš„å‘½ä»¤ç±»
)
```

### ä»£ç æ ¸å¿ƒéƒ¨åˆ†è§£é‡Šï¼š
1. **å¯¼å…¥æ¨¡å—**ï¼šå¯¼å…¥å¿…è¦çš„æ¨¡å—ï¼ŒåŒ…æ‹¬æ“ä½œç³»ç»Ÿæ¨¡å—ã€æ–‡ä»¶æŸ¥æ‰¾æ¨¡å—ã€PyTorchå’Œsetuptoolsæ¨¡å—ã€‚
2. **è·å–æ‰©å±•å‡½æ•°**ï¼š`get_extensions`å‡½æ•°è´Ÿè´£æŸ¥æ‰¾æºæ–‡ä»¶ï¼Œå¹¶æ ¹æ®CUDAçš„å¯ç”¨æ€§é€‰æ‹©åˆé€‚çš„æ‰©å±•ç±»å‹ï¼ˆCPUæˆ–CUDAï¼‰ã€‚
3. **è®¾ç½®ç¼–è¯‘å‚æ•°**ï¼šæ ¹æ®CUDAçš„å¯ç”¨æ€§è®¾ç½®é¢å¤–çš„ç¼–è¯‘å‚æ•°å’Œå®å®šä¹‰ã€‚
4. **æ„å»ºåŒ…**ï¼šä½¿ç”¨`setuptools`çš„`setup`å‡½æ•°å®šä¹‰åŒ…çš„åç§°ã€ç‰ˆæœ¬ã€ä½œè€…ã€æè¿°ç­‰ä¿¡æ¯ï¼Œå¹¶è°ƒç”¨`get_extensions`è·å–æ‰©å±•æ¨¡å—ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶æ˜¯ä¸€ä¸ªç”¨äºè®¾ç½®å’Œç¼–è¯‘DCNv3ï¼ˆDeformable Convolutional Networks v3ï¼‰æ‰©å±•æ¨¡å—çš„Pythonè„šæœ¬ï¼Œä¸»è¦ç”¨äºPyTorchæ¡†æ¶ã€‚è„šæœ¬çš„ç»“æ„å’ŒåŠŸèƒ½å¯ä»¥åˆ†ä¸ºå‡ ä¸ªä¸»è¦éƒ¨åˆ†ã€‚

é¦–å…ˆï¼Œæ–‡ä»¶å¼€å¤´åŒ…å«äº†ä¸€äº›ç‰ˆæƒä¿¡æ¯å’Œè®¸å¯è¯å£°æ˜ï¼Œè¡¨æ˜è¯¥ä»£ç æ˜¯ç”±OpenGVLabå¼€å‘ï¼Œå¹¶ä¸”éµå¾ªMITè®¸å¯è¯ã€‚æ¥ä¸‹æ¥ï¼Œè„šæœ¬å¯¼å…¥äº†ä¸€äº›å¿…è¦çš„åº“ï¼ŒåŒ…æ‹¬`os`ã€`glob`ã€`torch`ä»¥åŠPyTorchçš„C++æ‰©å±•å·¥å…·ã€‚

åœ¨`requirements`å˜é‡ä¸­ï¼Œå®šä¹‰äº†è¯¥æ¨¡å—æ‰€éœ€çš„ä¾èµ–åŒ…ï¼ŒåŒ…æ‹¬`torch`å’Œ`torchvision`ã€‚

æ¥ä¸‹æ¥çš„`get_extensions`å‡½æ•°æ˜¯è¯¥è„šæœ¬çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚å®ƒçš„ä¸»è¦ä»»åŠ¡æ˜¯æŸ¥æ‰¾å¹¶å‡†å¤‡è¦ç¼–è¯‘çš„C++å’ŒCUDAæºæ–‡ä»¶ã€‚é¦–å…ˆï¼Œå‡½æ•°è·å–å½“å‰æ–‡ä»¶çš„ç›®å½•ï¼Œå¹¶æ„å»ºæºæ–‡ä»¶çš„è·¯å¾„ã€‚å®ƒé€šè¿‡`glob`æ¨¡å—æŸ¥æ‰¾ä¸»æ–‡ä»¶ã€CPUå’ŒCUDAç›¸å…³çš„æºæ–‡ä»¶ã€‚

åœ¨ç¡®å®šäº†æºæ–‡ä»¶åï¼Œå‡½æ•°ä¼šæ ¹æ®CUDAçš„å¯ç”¨æ€§é€‰æ‹©åˆé€‚çš„æ‰©å±•ç±»å‹ã€‚å¦‚æœCUDAå¯ç”¨ï¼Œä½¿ç”¨`CUDAExtension`ï¼Œå¹¶å°†CUDAæºæ–‡ä»¶æ·»åŠ åˆ°ç¼–è¯‘åˆ—è¡¨ä¸­ï¼ŒåŒæ—¶å®šä¹‰å®`WITH_CUDA`ã€‚å¦‚æœCUDAä¸å¯ç”¨ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ª`NotImplementedError`ï¼Œæç¤ºç”¨æˆ·CUDAä¸å¯ç”¨ã€‚

æ¥ä¸‹æ¥ï¼Œå‡½æ•°æ„å»ºäº†ä¸€ä¸ªåŒ…å«æ‰€æœ‰æºæ–‡ä»¶å’Œç¼–è¯‘å‚æ•°çš„æ‰©å±•æ¨¡å—åˆ—è¡¨ï¼Œå¹¶è¿”å›è¿™ä¸ªåˆ—è¡¨ã€‚

æœ€åï¼Œè„šæœ¬è°ƒç”¨`setup`å‡½æ•°æ¥é…ç½®æ¨¡å—çš„æ„å»ºä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¨¡å—åç§°ã€ç‰ˆæœ¬ã€ä½œè€…ã€æè¿°ã€éœ€è¦æ’é™¤çš„åŒ…ï¼ˆå¦‚`configs`å’Œ`tests`ï¼‰ï¼Œä»¥åŠé€šè¿‡`get_extensions`å‡½æ•°è·å–çš„æ‰©å±•æ¨¡å—åˆ—è¡¨ã€‚`cmdclass`å‚æ•°æŒ‡å®šäº†æ„å»ºæ‰©å±•æ—¶ä½¿ç”¨çš„å‘½ä»¤ç±»ã€‚

æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªè„šæœ¬æ˜¯ä¸€ä¸ªå…¸å‹çš„Pythonæ‰©å±•æ¨¡å—è®¾ç½®æ–‡ä»¶ï¼Œæ—¨åœ¨ä¸ºDCNv3æä¾›PyTorchçš„CUDAåŠŸèƒ½å°è£…ï¼Œæ–¹ä¾¿ç”¨æˆ·åœ¨æ·±åº¦å­¦ä¹ é¡¹ç›®ä¸­ä½¿ç”¨ã€‚

### 12.ç³»ç»Ÿæ•´ä½“ç»“æ„ï¼ˆèŠ‚é€‰ï¼‰

### æ•´ä½“åŠŸèƒ½å’Œæ„æ¶æ¦‚æ‹¬

è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºYOLOï¼ˆYou Only Look Onceï¼‰ç›®æ ‡æ£€æµ‹ç®—æ³•çš„å®ç°ï¼Œä¸»è¦ç”¨äºç›®æ ‡æ£€æµ‹ã€å›¾åƒåˆ†å‰²å’Œç›¸å…³è®¡ç®—æœºè§†è§‰ä»»åŠ¡ã€‚é¡¹ç›®çš„ç»“æ„åŒ…æ‹¬å¤šä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—è´Ÿè´£ç‰¹å®šçš„åŠŸèƒ½ï¼Œå¦‚æ¨¡å‹è®­ç»ƒã€æ¨ç†ã€å·ç§¯æ“ä½œã€æ–‡ä»¶ä¸‹è½½å’Œæ‰©å±•æ¨¡å—çš„è®¾ç½®ç­‰ã€‚æ•´ä½“æ¶æ„æ—¨åœ¨æä¾›ä¸€ä¸ªçµæ´»ã€é«˜æ•ˆçš„æ¡†æ¶ï¼Œæ”¯æŒYOLOæ¨¡å‹çš„è®­ç»ƒå’Œæ¨ç†ï¼ŒåŒæ—¶å…è®¸ç”¨æˆ·è¿›è¡Œå„ç§è‡ªå®šä¹‰å’Œæ‰©å±•ã€‚

ä»¥ä¸‹æ˜¯é¡¹ç›®ä¸­å„ä¸ªæ–‡ä»¶çš„åŠŸèƒ½æ¦‚è¿°ï¼š

| æ–‡ä»¶è·¯å¾„                                                                 | åŠŸèƒ½æè¿°                                                                                   |
|--------------------------------------------------------------------------|------------------------------------------------------------------------------------------|
| `code\ultralytics\trackers\basetrack.py`                                | å®šä¹‰ç›®æ ‡è·Ÿè¸ªçš„åŸºç¡€ç±»å’ŒçŠ¶æ€ç®¡ç†ï¼Œæ”¯æŒYOLOç›®æ ‡æ£€æµ‹ä¸­çš„å¯¹è±¡è·Ÿè¸ªåŠŸèƒ½ã€‚                       |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\sam\modules\decoders.py` | å®ç°å›¾åƒæ©ç ç”Ÿæˆå’Œè´¨é‡è¯„åˆ†çš„è§£ç å™¨æ¨¡å—ï¼Œåˆ©ç”¨å˜æ¢å™¨æ¶æ„è¿›è¡Œæ©ç é¢„æµ‹ã€‚                     |
| `code\ultralytics\nn\modules\conv.py`                                   | æä¾›å¤šç§å·ç§¯æ“ä½œå’Œæ³¨æ„åŠ›æœºåˆ¶çš„å®ç°ï¼Œæ„å»ºæ·±åº¦å­¦ä¹ æ¨¡å‹çš„åŸºç¡€ç»„ä»¶ã€‚                        |
| `train.py`                                                              | å®ç°YOLOæ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ï¼ŒåŒ…æ‹¬æ•°æ®é›†æ„å»ºã€æ¨¡å‹è®¾ç½®ã€è®­ç»ƒç›‘æ§å’Œç»“æœå¯è§†åŒ–ç­‰åŠŸèƒ½ã€‚          |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\utils\downloads.py` | å¤„ç†ä¸YOLOæ¨¡å‹ç›¸å…³çš„æ–‡ä»¶ä¸‹è½½å’Œç®¡ç†ï¼ŒåŒ…æ‹¬ä¸‹è½½ã€è§£å‹ã€æ£€æŸ¥ç­‰æ“ä½œã€‚                        |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\nn\extra_modules\ops_dcnv3\setup.py` | è®¾ç½®å’Œç¼–è¯‘DCNv3æ‰©å±•æ¨¡å—ï¼Œæ”¯æŒPyTorchæ¡†æ¶çš„CUDAåŠŸèƒ½å°è£…ã€‚                               |
| `code\ultralytics\solutions\distance_calculation.py`                   | å®ç°è·ç¦»è®¡ç®—ç›¸å…³çš„åŠŸèƒ½ï¼Œå¯èƒ½ç”¨äºç›®æ ‡æ£€æµ‹ä¸­çš„ç›®æ ‡é—´è·æµ‹é‡æˆ–å…¶ä»–å‡ ä½•è®¡ç®—ã€‚                 |
| `code\ultralytics\models\yolo\classify\__init__.py`                   | åˆå§‹åŒ–YOLOåˆ†ç±»æ¨¡å‹çš„ç›¸å…³æ¨¡å—ï¼Œæä¾›åˆ†ç±»åŠŸèƒ½çš„æ¥å£ã€‚                                     |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\engine\predictor.py` | å®ç°æ¨¡å‹æ¨ç†çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œè´Ÿè´£å¤„ç†è¾“å…¥æ•°æ®å¹¶ç”Ÿæˆé¢„æµ‹ç»“æœã€‚                               |
| `code\ultralytics\engine\__init__.py`                                   | åˆå§‹åŒ–å¼•æ“æ¨¡å—ï¼Œå¯èƒ½åŒ…æ‹¬æ¨¡å‹åŠ è½½ã€æ¨ç†å’Œå…¶ä»–ç›¸å…³åŠŸèƒ½çš„æ¥å£ã€‚                           |
| `code\ultralytics\engine\model.py`                                      | å®šä¹‰YOLOæ¨¡å‹çš„ç»“æ„å’Œå‰å‘ä¼ æ’­é€»è¾‘ï¼Œè´Ÿè´£æ¨¡å‹çš„è®­ç»ƒå’Œæ¨ç†è¿‡ç¨‹ã€‚                           |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\nn\backbone\fasternet.py` | å®ç°FastNetéª¨å¹²ç½‘ç»œï¼Œå¯èƒ½ç”¨äºç‰¹å¾æå–å’Œæ¨¡å‹çš„åŸºç¡€ç»“æ„ã€‚                                 |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\nn\modules\conv.py` | æä¾›å·ç§¯æ“ä½œçš„å®ç°ï¼Œå¯èƒ½ä¸ä¹‹å‰çš„`conv.py`æ–‡ä»¶é‡å¤ï¼Œç¡®ä¿å·ç§¯åŠŸèƒ½çš„å®Œæ•´æ€§ã€‚              |

ä»¥ä¸Šè¡¨æ ¼æ€»ç»“äº†é¡¹ç›®ä¸­å„ä¸ªæ–‡ä»¶çš„ä¸»è¦åŠŸèƒ½ï¼Œå±•ç¤ºäº†é¡¹ç›®çš„æ¨¡å—åŒ–è®¾è®¡å’ŒåŠŸèƒ½åˆ†å·¥ã€‚æ•´ä½“ä¸Šï¼Œè¿™äº›æ¨¡å—å…±åŒæ„æˆäº†ä¸€ä¸ªå¼ºå¤§çš„ç›®æ ‡æ£€æµ‹å’Œè®¡ç®—æœºè§†è§‰æ¡†æ¶ï¼Œæ”¯æŒå¤šç§åº”ç”¨åœºæ™¯ã€‚

æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰â€ä¸­éƒ¨åˆ†ä»£ç å¯èƒ½ä¼šä¼˜åŒ–å‡çº§ï¼Œä»…ä¾›å‚è€ƒå­¦ä¹ ï¼Œå®Œæ•´â€œè®­ç»ƒæºç â€ã€â€œWebå‰ç«¯ç•Œé¢â€å’Œâ€œ70+ç§åˆ›æ–°ç‚¹æºç â€ä»¥â€œ13.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+70+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–â€çš„å†…å®¹ä¸ºå‡†ã€‚

### 13.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+70+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–

![19.png](19.png)


# [ä¸‹è½½é“¾æ¥ï¼šhttps://mbd.pub/o/bread/ZpuTmpZw](https://mbd.pub/o/bread/ZpuTmpZw)